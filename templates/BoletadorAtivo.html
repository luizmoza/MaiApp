<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>MaiApp - Boletador de Ativo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../static/images/icon/favicon.ico">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/css/themify-icons.css">
    <link rel="stylesheet" href="../static/css/metisMenu.css">
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/css/slicknav.min.css">
    <link rel="stylesheet" href="../static/css/typography.css">
    <link rel="stylesheet" href="../static/css/default-css.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">

    <script src="../static/js/util.js"></script>
</head>

<body>

<input id="hfUsuario_Id" type="hidden" value='{{ Usuario_Id }}'>
<input id="hfUsuario_Email" type="hidden" value='{{ Usuario_Email }}'>
<input id="hfUsuario_Auth" type="hidden" value='{{ Usuario_Auth }}'>
<input id="hfpicture" type="hidden" value='{{ picture }}'>
<input id="hfHeaderUserName" type="hidden" value='{{ HeaderUserName }}'>

<input id="hfIDMovSelecionado" type="hidden" value=''>
<input id="hfDataMov" type="hidden" value='{{ hoje }}'>

<input id="hfnTodasMarcadas" type="hidden" value=''>

<input id="hfDictListRateio" type="hidden" value=''>
<input id="hfDictRateio" type="hidden" value=''>




<div class="modal fade" id="ModalMsgBox" Name="ModalMsgBox">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mensagem</h5>
                    <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                </div>
                <div class="modal-body" id="tbModalMsgBox" name="tbModalMsgBox" style="height:25vh;">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " id="ModalBuscaAtivo" Name="ModalBuscaAtivo">
        <div class="modal-dialog modal-lg ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mensagem</h5>
                    <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <div class="col-sm-6 my-1">
                            <label>Grupo de Ativo</label>
                            <div class="input-group">
                                <select id="SlctGrupoAtivo" onChange="PupulaTipoAtivo(this.value)" class="form-control"
                                    style="font-size: 80%;">
                                    <option></option>
                                    <option>Cota</option>
                                    <option>RF</option>
                                    <option>RV</option>
                                    <option>Futuro</option>
                                    <option>Swap</option>
                                    <option>Opcao</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 my-1">
                            <label>Tipo de Ativo</label>
                            <div class="input-group">
                                <select id="SlctTipoAtivo" class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-12 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Buscar Por</div>
                                </div>
                                <input type="text" class="form-control" id="tbSearchFor" placeholder="Ex : PETR4">
                            </div>
                        </div>
                    </div>

                    <input id="hfPageBuscaAtivo" type="hidden">
                    <input id="hfnPagesBuscaAtivo" type="hidden">
                    <div class="pull-right" style="margin:0px 0px 50px 0px;">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination justify-content-end">
                                <li class="page-item">
                                    <a class="page-link" OnClick="AnteriorBuscaAtivo()">Anterior</a>
                                </li>
                                <li class="page-item"><a id="LblDisplayPageBuscaAtivo" class="page-link" href="#">-</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" OnClick="ProximoBuscaAtivo()">Próxima</a>
                                </li>
                            </ul>
                        </nav>
                    </div>


                    <div class="single-table">
                        <div class="table-responsive">
                            <table class="table text-center">
                                <thead class="text-uppercase">
                                    <tr>
                                        <th>Ativo</th>
                                        <th>Tipo</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="TblDadosBuscarAtivo">
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <a id="submit-btn-area-a" style="margin:0px 10px 0px 0px;width:100px;float:right;"
                        onClick="FiltrarAtivos()">Buscar Ativos</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " id="ModalBoleta" Name="ModalBoleta">
        <div class="modal-dialog modal-lg ">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Boleta</h5>
                    <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                </div>
                <div class="modal-body">


                    <div class="form-group row">
                        <div class="col-sm-6 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Ativo</div>
                                    <div class="input-group-text"><img src="../static/images/NotChecked.png"
                                            id="ImgCheckAtivo" style="width:30px;height:30px;margin:0px 0px 0px 0px;"
                                            alt="logo"></div>
                                </div>
                                <input type="text" class="form-control" id="tbAliasAtivo"
                                    placeholder="Ex : RV#BRLB3@PETR4">
                            </div>
                        </div>
                        <div class="col-sm-4 my-1">
                            <a id="submit-btn-area-a" style="margin:5px 10px 0px 0px;width:100px;float:right;"
                                onClick="BuscaAliasAtivo()">Valida</a>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-12 my-1">
                            <label>Alias Fundo</label>
                            <div class="input-group">
                                <select id="SlctAliasFundo" class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-4 my-1">
                            <label>Trader</label>
                            <div class="input-group">
                                <select id="SlctTraderBol" class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 my-1">
                            <label>Macro Estrategia</label>
                            <div class="input-group">
                                <select id="SlctMacroEstrategiaBol" onChange="PupulaComboMicroEstrategiaBol(this.value)"
                                    class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 my-1">
                            <label>Estrategia</label>
                            <div class="input-group">
                                <select id="SlctEstrategiaBol" class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 my-1">
                            <label>Marcação</label>
                            <div class="input-group">
                                <select id="SlctMarcacao" class="form-control" style="font-size: 80%;">
                                    <option value="MTM">MTM</option>
                                    <option value="Curva" >Curva</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4 my-1">
                            <label>Corretora</label>
                            <div class="input-group">
                                <select id="SlctCorretora" class="form-control" style="font-size: 80%;">
                                </select>
                            </div>
                        </div>

                        <div class="col-sm-4 my-1">
                            <div class="s-sw-title"
                                style="background-color:#F2F7FA;border-radius:25px;margin:30px 0px 0px 0px;float:right;">
                                <h5 style="Margin-Left:5px;">Corretagem Automática</h5>
                                <div class="s-swtich">
                                    <input type="checkbox" id="cbCorretCalc" />
                                    <label for="cbCorretCalc">Toggle</label>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="form-group row">
                        <div class="col-sm-6 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Qtd</div>
                                </div>
                                <input type="text" class="form-control" id="tbQtd" placeholder="Ex : 48"
                                    onkeyup="NumberOnly(this.id)">
                            </div>
                        </div>
                        <div class="col-sm-6 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Pu</div>
                                </div>
                                <input type="text" class="form-control" id="tbPu" placeholder="Ex : 21,50"
                                    onkeyup="NumberOnly(this.id)">
                            </div>
                        </div>
                        <div class="col-sm-6 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Taxa</div>
                                </div>
                                <input type="text" class="form-control" id="tbTaxa" placeholder="Ex : 0,04"
                                    onkeyup="NumberOnlyPerc(this.id)">
                            </div>
                        </div>
                        <div class="col-sm-6 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Corret.</div>
                                </div>
                                <input type="text" class="form-control" id="tbCorretagem" placeholder="Ex : 0,04"
                                    onkeyup="NumberOnly(this.id)">
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-6 my-1">
                            <label>Tipo Compromisso</label>
                            <div class="input-group">
                                <select id="SlctTipoCompromisso" class="form-control" style="font-size: 80%;">
                                    <option>Sem Compromisso</option>
                                    <option>Compra a Termo</option>
                                    <option>Venda a Termo</option>
                                    <option>Compra Compromissada</option>
                                    <option>Venda Compromissada</option>
                                    <option>Liquidação Termo</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 my-1">
                            <div class="input-group" style="margin:20px 0px 0px 0px;float:right;">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Data Compromisso</div>
                                    <input class="form-control" type="date" value="" id="tbDataCompromisso" disabled="True" >
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 my-1">
                            <div class="input-group" style="margin:20px 0px 0px 0px;float:right;">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Pu Compromisso</div>
                                </div>
                                <input type="text" class="form-control" id="tbPuCompromisso" placeholder="Ex : 0,04" value = '0' disabled="True" onkeyup="NumberOnly(this.id)">
                            </div>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <a id="submit-btn-area-a" style="margin:0px 10px 0px 0px;width:100px;float:right;"
                        onClick="GravaBoleta()">Gravar</a>
                </div>
            </div>
        </div>
    </div>

    <div id="preloader">
        <div class="loader"></div>
    </div>


    <div class="page-container">
        {{ SideBar }}
        <div class="main-content">
            {{ Header }}
         <div class="main-content-inner">
                <div class="row">
                    <div class="col-lg-12 col-ml-12">
                        <div class="row">
                            <div class="col-12 mt-5">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title">Boletador Ativo</h4>
                                        <form>
                                            <div class="form-row align-items-center">
                                                <div class="col-sm-3 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">Inicio</div>
                                                            <input class="form-control" type="date" value={{hoje}} id="tbDataIni">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-3 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">Fim</div>
                                                            <input class="form-control" type="date" value={{hoje}} id="tbDataFim">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>



                                            <div class="form-group row">

                                                <div class="col-sm-3 my-1">
                                                    <label>Trader</label>
                                                    <div class="input-group">
                                                        <select id="SlctTrader" class="form-control"
                                                            style="font-size: 80%;">
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 my-1">
                                                    <label>Macro Estrategia</label>
                                                    <div class="input-group">
                                                        <select id="SlctMacroEstrategia"
                                                            onChange="PupulaComboMicroEstrategia(this.value)"
                                                            class="form-control" style="font-size: 80%;">
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 my-1">
                                                    <label>Estrategia</label>
                                                    <div class="input-group">
                                                        <select id="SlctEstrategia" class="form-control"
                                                            style="font-size: 80%;">
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>


                                            <div>
                                                <a id="submit-btn-area-a"
                                                    style="margin:10px 10px 0px 0px;width:150px;float:right;"
                                                    onClick="NovaBoleta()">Criar Boleta</a>
                                                <a id="submit-btn-area-a"
                                                    style="margin:10px 10px 0px 0px;width:150px;float:right;"
                                                    onClick="CarregaBuscas()">Buscar</a>
                                            </div>

                                        </form>



                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12 col-ml-12">
                        <div class="row">
                            <div class="col-12 mt-5">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title">Boletas Alocadas</h4>

                                        <div class="search-box pull-left" style="margin:20px 0px 20px 0px;">
                                            <form action="#">
                                                <input type="text" id="tbSearch" name="search" placeholder="Search..."
                                                    required>
                                                <a style="cursor:pointer;" OnClick="CarregaBusca()"><i
                                                        class="ti-search"></i></a>
                                            </form>
                                        </div>

                                        <input id="hfPage" type="hidden">
                                        <input id="hfnPages" type="hidden">
                                        <input id="hfnCount" type="hidden">
                                        <div class="pull-right" style="margin:0px 0px 50px 0px;">
                                            <nav aria-label="Page navigation example">
                                                <ul class="pagination justify-content-end">
                                                    <li class="page-item">
                                                        <a class="page-link" OnClick="Anterior()">Anterior</a>
                                                    </li>
                                                    <li class="page-item"><a id="LblDisplayPage" class="page-link"
                                                            href="#">-</a></li>
                                                    <li class="page-item">
                                                        <a class="page-link" OnClick="Proximo()">Próxima</a>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>

                                        <div class="single-table">
                                            <div class="table-responsive">
                                                <table class="table text-center">
                                                    <thead class="text-uppercase">
                                                        <tr>
                                                            <th>idBoleta</th>
                                                            <th>Data</th>
                                                            <th>Alias Fundo</th>
                                                            <th>AliasAtivo</th>
                                                            <th>Qtd</th>
                                                            <th>Pu</th>
                                                            <th>Taxa</th>
                                                            <th>Estrategia</th>
                                                            <th></th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="TblDadosRatiadas">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>


                </div>

            </div>
        </div>
        <!-- main content area end -->
    </div>
   <!-- main content area end -->
        <!-- footer area start-->
        <footer>
            <div class="footer-area">
                <p>© Versão Beta</p>
            </div>
        </footer>
        <!-- footer area end-->
    </div>
    

    <script src="../static/js/modernizr-2.8.3.min.js"></script>
    <script src="../static/js/jquery-2.2.4.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/metisMenu.min.js"></script>
    <script src="../static/js/jquery.slimscroll.min.js"></script>
    <script src="../static/js/jquery.slicknav.min.js"></script>
    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/scripts.js"></script>



    <script>
        var jsonData = JSON.parse('{{ jsnDt | tojson | safe}}');

        var DictCGCFundoid = jsonData['DictCGCFundoid'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value','');
            document.getElementById('SlctAliasFundo').appendChild(z) ;
            for (var key in DictCGCFundoid) {
            var z = document.createElement('option');
            z.innerHTML = DictCGCFundoid[key].Alias;
            z.setAttribute('value',key);
            document.getElementById('SlctAliasFundo').appendChild(z) ;
        }

        var DictListRateio = jsonData['DictListRateio'] 
        var DictRateio = jsonData['DictRateio'] 
        document.getElementById('hfDictRateio').value = JSON.stringify(DictRateio)
        document.getElementById('hfDictListRateio').value = JSON.stringify(DictListRateio)

        var DictTrader = jsonData['DictTrader'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value',-1);
            document.getElementById('SlctTrader').appendChild(z) ;
        for (var key in DictTrader) {
            var z = document.createElement('option');
            z.innerHTML = DictTrader[key];
            z.setAttribute('value',key);
            document.getElementById('SlctTrader').appendChild(z) ;
        }

        var DictTrader = jsonData['DictTrader'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value',-1);
            document.getElementById('SlctTraderBol').appendChild(z) ;
        for (var key in DictTrader) {
            var z = document.createElement('option');
            z.innerHTML = DictTrader[key];
            z.setAttribute('value',key);
            document.getElementById('SlctTraderBol').appendChild(z) ;
        }


        var z = document.createElement('option'); 
        z.innerHTML = 'Selecione ...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        z.setAttribute('value',-1);
        document.getElementById('SlctEstrategia').appendChild(z) ;

        var z = document.createElement('option'); 
        z.innerHTML = 'Selecione ...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        z.setAttribute('value',-1);
        document.getElementById('SlctEstrategiaBol').appendChild(z) ;


        var DictMacroEstrat = jsonData['DictMacroEstrat'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value','');
            document.getElementById('SlctMacroEstrategiaBol').appendChild(z) ;
        for (var key in DictMacroEstrat) {
            var z = document.createElement('option');
            z.innerHTML = key;
            z.setAttribute('value',key);
            document.getElementById('SlctMacroEstrategiaBol').appendChild(z) ;
        }

        

        var DictMacroEstrat = jsonData['DictMacroEstrat'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value','');
            document.getElementById('SlctMacroEstrategia').appendChild(z) ;
        for (var key in DictMacroEstrat) {
            var z = document.createElement('option');
            z.innerHTML = key;
            z.setAttribute('value',key);
            document.getElementById('SlctMacroEstrategia').appendChild(z) ;
        }


        var DictContraparte = jsonData['DictContraparte'] 
        var z = document.createElement('option'); 
            z.innerHTML = 'Selecione ...';
            z.setAttribute('disabled',true);
            z.setAttribute('selected',true);
            z.setAttribute('value','');
            document.getElementById('SlctCorretora').appendChild(z) ;
        for (var key in DictContraparte) {
            var z = document.createElement('option');
            z.innerHTML = DictContraparte[key];
            z.setAttribute('value',key);
            document.getElementById('SlctCorretora').appendChild(z) ;
        }


        var UserName = document.getElementById('hfHeaderUserName').value;
        var picturepath = document.getElementById('hfpicture').value;
        document.getElementById('imgProfile').src = picturepath;
        document.getElementById('NameUser').innerHTML = UserName + "<i class='fa fa-angle-down'></i>";


        document.addEventListener('paste', function (evt) {
            clipdata = evt.clipboardData || window.clipboardData;
            var data = clipdata.getData('text/plain');
            var array = data.split(/\r?\n/);
            var r = 0;
            var Tbl = document.getElementById("TblDadosSimulacao");
            while (row = Tbl.rows[r++]) {
                var id = row.getAttribute("id");
                if (r in array) {
                    document.getElementById("tbExpAtual#" + id).value = array[r - 1];
                }
                }
                }
        );




    </script>



<script>


function PupulaComboMicroEstrategia(valor){
DictEstrategias = jsonData['DictEstrategias'][valor] 
for (var key in DictEstrategias) {
    var z = document.createElement('option');
    z.innerHTML = key;
    z.setAttribute('value',DictEstrategias[key]);
    document.getElementById('SlctEstrategia').appendChild(z) ;
}
}

function PupulaComboMicroEstrategiaBol(valor) {
DictEstrategias = jsonData['DictEstrategias'][valor] 
for (var key in DictEstrategias) {
    var z = document.createElement('option');
    z.innerHTML = key;
    z.setAttribute('value',DictEstrategias[key]);
    document.getElementById('SlctEstrategiaBol').appendChild(z) ;
}
}



function PupulaTipoAtivo(Macro) {
    var oReq = new XMLHttpRequest();
    var fd = new FormData();
    var SlctTipoAtivo = document.getElementById("SlctTipoAtivo")
    while (SlctTipoAtivo.lastElementChild) { SlctTipoAtivo.removeChild(SlctTipoAtivo.lastElementChild); }
    var opt = document.createElement("option");
    opt.innerHTML = '';
    SlctTipoAtivo.appendChild(opt);
    fd.append("TipoAtivo", Macro);
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    oReq.open("POST", "/Boletador/Ativo/CarregaTiposAtivoPorGrupo", true);
    oReq.onload = function (e) {
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){
            window.location.href = "/Login";
        }else if(trim(result['resposta']) == trim("Ok")){      
                var Dados = result['Dados'];
                for (k in Dados) {
                    var opt = document.createElement("option");
                    opt.innerHTML = Dados[k].Nome;
                    opt.setAttribute('value',Dados[k].Nome);
                    SlctTipoAtivo.appendChild(opt);
                }
        }
    }
    oReq.send(fd);
}



function NovaBoleta() {
    document.getElementById("hfIDMovSelecionado").value = -1;
    $(document).ready(function () { $('#ModalBoleta').modal('show') });
}

function BuscaAliasAtivo() {
    var alias = document.getElementById("tbAliasAtivo").value;
    var grupo = trim(Left(alias, alias.search("#")));
    document.getElementById("SlctGrupoAtivo").value = grupo;
    document.getElementById("tbSearchFor").value = alias;
    $(document).ready(function () { $('#ModalBoleta').modal('hide') });
    $(document).ready(function () { $('#ModalBuscaAtivo').modal('show') });

    var oReq = new XMLHttpRequest();
    var fd = new FormData();
    var SlctTipoAtivo = document.getElementById("SlctTipoAtivo")
    while (SlctTipoAtivo.lastElementChild) { SlctTipoAtivo.removeChild(SlctTipoAtivo.lastElementChild); }
    var opt = document.createElement("option");
    opt.innerHTML = '';
    SlctTipoAtivo.appendChild(opt);
    fd.append("TipoAtivo", grupo);
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    oReq.open("POST", "/Boletador/Ativo/CarregaTiposAtivoPorGrupo", true);
    oReq.onload = function (e) {
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){
            window.location.href = "/Login";
        }else if(trim(result['resposta']) == trim("Ok")){      
                var Dados = result['Dados'];
                for (k in Dados) {
                    var opt = document.createElement("option");
                    opt.innerHTML =  Dados[k].Nome;
                    opt.setAttribute('value',Dados[k].Nome);
                    SlctTipoAtivo.appendChild(opt);
                }
        }
    }
    oReq.send(fd);    
}

function FiltrarAtivos() {
    document.getElementById("hfPageBuscaAtivo").value = 1;
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    fd.append("Search", document.getElementById("tbSearchFor").value);
    fd.append("Tipo", document.getElementById("SlctTipoAtivo").value);
    fd.append("Grupo", document.getElementById("SlctGrupoAtivo").value);
    fd.append("Pag", 1);
    fd.append("nPerPag", 5);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/DadosBuscarAtivo", true);
    oReq.onload = function () {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDadosBuscarAtivo");
        while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
        Tbl.innerhtml = "";
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {
            var dvMdl = document.getElementById("tbModalMsgBox");
            while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
            dvMdl.innerhtml = "";
            var span = document.createElement('span');
            span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
            dvMdl.appendChild(span);
            span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
            $(document).ready(function(){$('#ModalMsgBox').modal('show');})
            return;
        }
        else{
            var Dados=result['Dados'];
            document.getElementById("hfnPagesBuscaAtivo").value = Dados["nPags"];
            document.getElementById("LblDisplayPageBuscaAtivo").innerText = Dados["Pag"] + " de " + Math.max(Dados["nPags"], 1);
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                var Link = document.createElement('a');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Codigo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Tipo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="SelectObj#' + k + '" onClick="SelecionaAtivo(this.id)"><i style="font-size: 2em;" class="ti-control-forward"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
            }
        }
    }
    oReq.send(fd);
}

function ProximoBuscaAtivo() {

    if(parseFloat(document.getElementById("hfnPagesBuscaAtivo").value) >= parseFloat(document.getElementById("hfPageBuscaAtivo").value)+1)
    {document.getElementById("hfPageBuscaAtivo").value=parseFloat(document.getElementById("hfPageBuscaAtivo").value)+1;}

    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

    fd.append("Search", document.getElementById("tbSearchFor").value);
    fd.append("Tipo", document.getElementById("SlctTipoAtivo").value);
    fd.append("Grupo", document.getElementById("SlctGrupoAtivo").value);
    fd.append("Pag", document.getElementById("hfPageBuscaAtivo").value);
    fd.append("nPerPag", 5);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/DadosBuscarAtivo", true);
    oReq.onload = function () {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDadosBuscarAtivo");
        while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
        Tbl.innerhtml = "";
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {
            var dvMdl = document.getElementById("tbModalMsgBox");
            while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
            dvMdl.innerhtml = "";
            var span = document.createElement('span');
            span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
            dvMdl.appendChild(span);
            span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
            $(document).ready(function(){$('#ModalMsgBox').modal('show');})
            return;
        }
        else{
            var Dados=result['Dados'];
            document.getElementById("hfnPagesBuscaAtivo").value = Dados["nPags"];
            document.getElementById("LblDisplayPageBuscaAtivo").innerText = Dados["Pag"] + " de " + Math.max(Dados["nPags"], 1);
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                var Link = document.createElement('a');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Codigo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Tipo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="SelectObj#' + k + '" onClick="SelecionaAtivo(this.id)"><i style="font-size: 2em;" class="ti-control-forward"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
            }
        }
    }
    oReq.send(fd);
}


function AnteriorBuscaAtivo() {
    if (1 <= parseFloat(document.getElementById("hfPageBuscaAtivo").value) - 1) { document.getElementById("hfPageBuscaAtivo").value = parseFloat(document.getElementById("hfPageBuscaAtivo").value) - 1; } else { throw new Error("Não tem pagina menor que 1!"); }
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

    fd.append("Search", document.getElementById("tbSearchFor").value);
    fd.append("Tipo", document.getElementById("SlctTipoAtivo").value);
    fd.append("Grupo", document.getElementById("SlctGrupoAtivo").value);
    fd.append("Pag", document.getElementById("hfPageBuscaAtivo").value);
    fd.append("nPerPag", 5);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/DadosBuscarAtivo", true);
    oReq.onload = function () {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDadosBuscarAtivo");
        while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
        Tbl.innerhtml = "";
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {
            var dvMdl = document.getElementById("tbModalMsgBox");
            while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
            dvMdl.innerhtml = "";
            var span = document.createElement('span');
            span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
            dvMdl.appendChild(span);
            span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
            $(document).ready(function(){$('#ModalMsgBox').modal('show');})
            return;
        }
        else{
            var Dados=result['Dados'];
            document.getElementById("hfnPagesBuscaAtivo").value = Dados["nPags"];
            document.getElementById("LblDisplayPageBuscaAtivo").innerText = Dados["Pag"] + " de " + Math.max(Dados["nPags"], 1);
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                var Link = document.createElement('a');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Codigo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Tipo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="SelectObj#' + k + '" onClick="SelecionaAtivo(this.id)"><i style="font-size: 2em;" class="ti-control-forward"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
            }
        }
    }
    oReq.send(fd);
}


function SelecionaAtivo(s) {
    var idLista = document.getElementById(s).id;
    var idLista = trim(Right(idLista, idLista.length - idLista.search("#") - 1));
    $(document).ready(function () { $('#ModalBoleta').modal('show') });
    $(document).ready(function () { $('#ModalBuscaAtivo').modal('hide') });
    document.getElementById("tbAliasAtivo").value = idLista;
    var ImgCheckAtivo = document.getElementById("ImgCheckAtivo");
    ImgCheckAtivo.setAttribute('src', "../static/images/Checked.png");
}

function GravaBoleta() {
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    fd.append("CGC", DictCGCFundoid[document.getElementById("SlctAliasFundo").value]['CGC']);
    fd.append("idTrader", document.getElementById("SlctTraderBol").value);
    fd.append("idCorretora", document.getElementById("SlctCorretora").value);
    fd.append("idEstrategia", document.getElementById("SlctEstrategiaBol").value);
    fd.append("IDMov", document.getElementById("hfIDMovSelecionado").value);
    fd.append("Qtd", vl_to_float(document.getElementById("tbQtd").value));
    fd.append("Pu", vl_to_float(document.getElementById("tbPu").value));
    fd.append("Corretagem", vl_to_float(document.getElementById("tbCorretagem").value));
    fd.append("PuCompromisso", vl_to_float(document.getElementById("tbPuCompromisso").value));
    fd.append("Taxa", taxa_to_perc(document.getElementById("tbTaxa").value));
    fd.append("AliasAtivo", document.getElementById("tbAliasAtivo").value);
    fd.append("TipoCompromisso", document.getElementById("SlctTipoCompromisso").value);
    fd.append("Marcacao", document.getElementById("SlctMarcacao").value);
    fd.append("DataMov", document.getElementById("hfDataMov").value);
    fd.append("DataCompromisso", document.getElementById("tbDataCompromisso").value);

    var imgcheck = document.getElementById("ImgCheckAtivo");
    var atributo = imgcheck.src;
    if (Right(atributo, Len("../static/NotChecked.png")) == "../static/images/NotChecked.png") 
    { Msgbox('Ativo Inválido!'); $(document).ready(function () { $('#ModalBoleta').modal('hide') }); throw new Error("Something went badly wrong!");; }

    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Upsert", true);
    oReq.onload = function () {
        var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";}
            else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');});
                    $(document).ready(function () { $('#ModalBoleta').modal('hide') });
                }
    }
    oReq.send(fd);
}

function Msgbox(msg) {
    var dvMdl = document.getElementById("tbModalMsgBox");
    while (dvMdl.lastElementChild) { dvMdl.removeChild(dvMdl.lastElementChild); }
    dvMdl.innerhtml = "";
    var span = document.createElement('span');
    span.setAttribute('style', "float:left;margin:15px 0px 0px 15px;");
    span.innerHTML = "<p>" + msg + "</p>";
    dvMdl.appendChild(span);
    $(document).ready(function () { $('#ModalMsgBox').modal('show'); })
}

function CarregaBuscas() {
    CarregaBusca();
}

function CarregaBusca() {
    document.getElementById("hfPage").value = 1;
    var fd = new FormData();

    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

    fd.append("Search", document.getElementById("tbSearch").value);
    fd.append("DataIni", document.getElementById("tbDataIni").value);
    fd.append("DataFim", document.getElementById("tbDataFim").value);
    fd.append("idEstrategia",  document.getElementById("SlctEstrategia").value); 
    fd.append("idTrader", document.getElementById("SlctTrader").value); 
    fd.append("CGC", '');

    fd.append("Pag", 1);
    fd.append("nPerPag", 50);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Search", true);
    oReq.onload = function () {

        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDadosRatiadas"); 
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {
        document.getElementById("LblDisplayPage").innerText='-';
        Msgbox(trim(result['resposta']));
        exit;
        }
        else{
            while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
            Tbl.innerhtml = "";
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["IDMov"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["datamov"]; Header.appendChild(HeaderCol);                
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasFundo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasAtivo"]; HeaderCol.setAttribute('id', "AliasAtivoPool#" + k); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Qtd"]); HeaderCol.setAttribute('id', "QtdPool#" + k); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Pu"]); HeaderCol.setAttribute('id', "PuPool#" + k); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = perc_to_taxa_brl(Dados["Lista"][k]["Taxa"]); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Estrategia"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DeleteObj#' + k + '" onClick="Delete(this.id)"><i class="ti-trash"></i></a>'; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DisplayObj#' + k + '" onClick="Display(this.id)"><i class="ti-eye"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
                }
        }
    }
    oReq.send(fd);
}


function Proximo() {
    if (parseFloat(document.getElementById("hfnPages").value) >= parseFloat(document.getElementById("hfPage").value) + 1) {
        document.getElementById("hfPage").value = parseFloat(document.getElementById("hfPage").value) + 1;
    }

    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

    fd.append("Search", document.getElementById("tbSearch").value);
    fd.append("DataIni", document.getElementById("tbDataIni").value);
    fd.append("DataFim", document.getElementById("tbDataFim").value);
    fd.append("idEstrategia",  document.getElementById("SlctEstrategia").value); 
    fd.append("idTrader", document.getElementById("SlctTrader").value); 
    fd.append("CGC", '');

    fd.append("Pag", document.getElementById("hfPage").value);
    fd.append("nPerPag", 50);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Search", true);
    oReq.onload = function () {
        var Tbl = document.getElementById("TblDadosRatiadas");
        if (trim(this.responseText) == trim("Erro")) { throw new Error("Erro no PHP. Abortado!"); exit; } else { var Dados = JSON.parse(oReq.responseText); }
        while (Tbl.lastElementChild) { Tbl.removeChild(Tbl.lastElementChild); }
        Tbl.innerhtml = "";
        document.getElementById("hfnPages").value = Dados["nPags"];
        document.getElementById("hfnCount").value = Dados["nCount"];
        document.getElementById("LblDisplayPage").innerText = Dados["Pag"] + " de " + Math.max(Dados["nPags"], 1) + " páginas";
        for (k in Dados["Lista"]) {
            if (Dados["Lista"][k]["AliasFundo"] !== "Pool de Boletas") {
                var Header = document.createElement('tr');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["IDMov"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["datamov"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasFundo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasAtivo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Qtd"]); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Pu"]); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = perc_to_taxa_brl(Rounder(Dados["Lista"][k]["Taxa"], 2)); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Estrategia"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DeleteObj#' + k + '" onClick="Delete(this.id)"><i class="ti-trash"></i></a>'; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DisplayObj#' + k + '" onClick="Display(this.id)"><i class="ti-eye"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
            }
        }
    }
    oReq.send(fd);
}


function Anterior() {
    if (1 <= parseFloat(document.getElementById("hfPage").value) - 1) { document.getElementById("hfPage").value = parseFloat(document.getElementById("hfPage").value) - 1; }
    else { throw new Error("Não tem pagina menor que 1!"); }
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

    fd.append("Search", document.getElementById("tbSearch").value);
    fd.append("DataIni", document.getElementById("tbDataIni").value);
    fd.append("DataFim", document.getElementById("tbDataFim").value);
    fd.append("idEstrategia",  document.getElementById("SlctEstrategia").value); 
    fd.append("idTrader", document.getElementById("SlctTrader").value); 
    fd.append("CGC", '');
    fd.append("Pag", document.getElementById("hfPage").value);
    fd.append("nPerPag", 50);
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Search", true);
    oReq.onload = function () {
        var Tbl = document.getElementById("TblDadosRatiadas");
        if (trim(this.responseText) == trim("Erro")) { throw new Error("Erro no PHP. Abortado!"); exit; } else { var Dados = JSON.parse(oReq.responseText); }
        while (Tbl.lastElementChild) { Tbl.removeChild(Tbl.lastElementChild); }
        Tbl.innerhtml = "";
        document.getElementById("hfnPages").value = Dados["nPags"];
        document.getElementById("hfnCount").value = Dados["nCount"];
        document.getElementById("LblDisplayPage").innerText = Dados["Pag"] + " de " + Math.max(Dados["nPags"], 1) + " páginas";
        for (k in Dados["Lista"]) {
            if (Dados["Lista"][k]["AliasFundo"] !== "Pool de Boletas") {
                var Header = document.createElement('tr');
                Header.setAttribute('class', "heading-td")
                Header.setAttribute('id', k);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["IDMov"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["datamov"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasFundo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["AliasAtivo"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Qtd"]); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = vl_to_float_brl(Dados["Lista"][k]["Pu"]); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = perc_to_taxa_brl(Rounder(Dados["Lista"][k]["Taxa"], 2)); Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = Dados["Lista"][k]["Estrategia"]; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DeleteObj#' + k + '" onClick="Delete(this.id)"><i class="ti-trash"></i></a>'; Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td'); HeaderCol.innerHTML = '<a id="DisplayObj#' + k + '" onClick="Display(this.id)"><i class="ti-eye"></i></a>'; Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
            }
        }
    }
    oReq.send(fd);
}

function Delete(s) {
    var idLista = document.getElementById(s).id;
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    fd.append("IDMov", trim(Right(idLista, idLista.length - idLista.search("#") - 1)));
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Delete", true);
    oReq.onload = function () {
        var Tbl = document.getElementById("TblDadosRatiadas");
        var vv = false;
        for (var i = 0, row; row = Tbl.rows[i]; i++) {
            if (row.getAttribute('id') == trim(Right(idLista, idLista.length - idLista.search("#") - 1))) {
                Tbl.deleteRow(i);
            }
        }
        Msgbox(trim(JSON.parse(this.responseText)['resposta']));        
    }
    oReq.send(fd);
}


function Display(s) {

    var idLista = document.getElementById(s).id;
    var fd = new FormData();
    fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
    fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
    fd.append("IDMov", trim(Right(idLista, idLista.length - idLista.search("#") - 1)));
    var oReq = new XMLHttpRequest();
    oReq.open('POST', "/Boletador/Ativo/Load", true);
    oReq.onload = function () {

        if (trim(JSON.parse(this.responseText)['resposta']) == trim("Erro")) 
        { throw new Error("Erro no PHP. Abortado!"); exit; } 
        else { var Dados = JSON.parse(this.responseText)['Dados']; }

        document.getElementById("SlctAliasFundo").value = jsonData.DictCGCFundoidCGC[Dados["CGC"]]['idFundo'];
        document.getElementById("SlctTraderBol").value = Dados["idTrader"];
        document.getElementById("SlctCorretora").value = Dados["idCorretora"];
        document.getElementById("SlctMacroEstrategiaBol").value = jsonData.DictMacroEstratID[Dados["idEstrategia"]];

        var vv = false;
        for (i = 0; i < document.getElementById("SlctEstrategiaBol").length; ++i) {
            if (document.getElementById("SlctEstrategiaBol").options[i].value == jsonData.DictEstratID[Dados["idEstrategia"]] ) {
                vv = true;
            }
        }
        if (vv == false) {
            const newOption = document.createElement('option');
            newOption.innerHTML = jsonData.DictEstratID[Dados["idEstrategia"]];
            newOption.setAttribute('value',Dados["idEstrategia"])
            document.getElementById("SlctEstrategiaBol").appendChild(newOption);
        }

        document.getElementById("SlctEstrategiaBol").value = Dados["idEstrategia"];
        document.getElementById("hfIDMovSelecionado").value = Dados["IDMov"];
        document.getElementById("tbQtd").value = vl_to_float_brl(Dados["Qtd"]);
        document.getElementById("tbPu").value = vl_to_float_brl(Dados["Pu"]);
        document.getElementById("tbCorretagem").value = vl_to_float_brl(Dados["Corretagem"]);
        document.getElementById("tbPuCompromisso").value = vl_to_float_brl(Dados["PuCompromisso"]);
        document.getElementById("tbTaxa").value = perc_to_taxa_brl(Dados["Taxa"]);
        document.getElementById("tbAliasAtivo").value = Dados["AliasAtivo"];
        document.getElementById("SlctTipoCompromisso").value = Dados["TipoCompromisso"];
        document.getElementById("SlctMarcacao").value = Dados["Marcacao"];
        document.getElementById("hfDataMov").value = (Dados["DataMov"]);
        document.getElementById("tbDataCompromisso").value = (Dados["DataCompromisso"]);
        var imgcheck = document.getElementById("ImgCheckAtivo");
        imgcheck.src = "../static/images/Checked.png";
        $(document).ready(function () { $('#ModalBoleta').modal('show') });
    }
    oReq.send(fd);
}
</script>

</body>

</html>