<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>MaiApp - Cadastro de Renda Fixa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../static/images/icon/favicon.ico">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/css/themify-icons.css">
    <link rel="stylesheet" href="../static/css/metisMenu.css">
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/css/slicknav.min.css">
    <link rel="stylesheet" href="../static/css/typography.css">
    <link rel="stylesheet" href="../static/css/default-css.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">

    <script src="../static/js/util.js"></script>

</head>

<body>

    <input id="hfUsuario_Id" type="hidden" value='{{ Usuario_Id }}'>
    <input id="hfUsuario_Email" type="hidden" value='{{ Usuario_Email }}'>
    <input id="hfUsuario_Auth" type="hidden" value='{{ Usuario_Auth }}'>
    <input id="hfpicture" type="hidden" value='{{ picture }}'>
    <input id="hfHeaderUserName" type="hidden" value='{{ HeaderUserName }}'>
    <input id="hfFlux" type="hidden" value=''>


                                <div class="modal fade" id="ModalMsgBox" Name="ModalMsgBox">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Mensagem</h5>
                                                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                                            </div>
                                            <div class="modal-body" id="tbModalMsgBox" name="tbModalMsgBox" style="height:25vh;">
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>



   <div id="preloader">
        <div class="loader"></div>
    </div>



    <div class="page-container">
        {{ SideBar }}
        <div class="main-content">
            {{ Header }}
         <div class="main-content-inner">
                <div class="row">
                    <div class="col-lg-6 col-ml-12">
                        <div class="row">
                            <div class="col-12 mt-5">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title">Renda Fixa</h4>

                    

<!-- Formulario MAIN -->
                                        <form>
                                            <div class="form-row align-items-center">
                                                <div class="col-sm-3 my-1">
                                                    <fieldset disabled>
													<div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">idRF</div></div>
                                                        <input type="text" class="form-control" id="tbIDRF" placeholder="">
                                                    </div>
													</fieldset>
                                                </div>
                                               <div class="col-sm-9 my-1">
                                               <fieldset disabled>
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Alias</div></div>
                                                        <input type="text" class="form-control" id="tbAlias" placeholder="">
                                                    </div>
													</fieldset>
                                                </div>
												<div class="col-sm-12 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Codigo</div></div>
                                                        <input type="text" class="form-control" id="tbCodigo" placeholder="Ex : PETR26">
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Agente Fiduciário</div></div>
                                                        <input type="text" class="form-control" id="tbAgenteFiduciario" placeholder="Ex : BRADESCO">
                                                    </div>
                                                </div>
												<div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Coordenador Lider</div></div>
                                                        <input type="text" class="form-control" id="tbCoordenadorLider" placeholder="Ex : BRADESCO">
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">ISIN</div></div>
                                                        <input type="text" class="form-control" id="tbIsin" placeholder="Ex : 00000000000000">
                                                    </div>
                                                </div>
												
                                            </div>

<!-- Formulario Checkboxes -->
                                         
										 <div class="form-row align-items-center">

                                            <div class="col-sm-5 my-1" style="Margin-Left:20px;">
												<div class="s-settings">
													<p style="Margin:20px 0px 20px 0px;" > 	</p>
													<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
														<h5 style="Margin-Left:5px;">Emissão Pública Ou Dispensa CVM</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbRegistroCVM" />
															<label for="cbRegistroCVM">Toggle</label>
														</div>
													</div>
														<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
													<h5 style="Margin-Left:5px;">Incorpora Juros</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbIncorporaJuros" />
															<label for="cbIncorporaJuros">Toggle</label>
														</div>
													</div>
													<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
														<h5 style="Margin-Left:5px;">Resgate Antecipado</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbResgateAntecipado" />
															<label for="cbResgateAntecipado">Toggle</label>
														</div>
													</div>
												</div>
											</div>
                                            <div class="col-sm-3 my-1" style="Margin-Left:20px;">
												<div class="s-settings">
												<p style="Margin:20px 0px 20px 0px;" ></p>
													<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
														<h5 style="Margin-Left:5px;">Em Default</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbEmDefault" />
															<label for="cbEmDefault">Toggle</label>
														</div>
													</div>
													<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
														<h5 style="Margin-Left:5px;">Com Coobrigação</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbCoobrigacao" checked />
															<label for="cbCoobrigacao">Toggle</label>
														</div>
													</div>
													

													<div class="s-sw-title" style="background-color:#F2F7FA;border-radius:25px;">
														<h5 style="Margin-Left:5px;">Incentivada</h5>
														<div class="s-swtich">
															<input type="checkbox" id="cbIncentivada" />
															<label for="cbIncentivada">Toggle</label>
														</div>
													</div>

													
												</div>
											</div>

										</div>


<!-- Formulario Combo Boxes -->

                                            <div class="form-group row">
    											<div class="col-sm-2 my-1">
   												<label>Bolsa</label>
                                                    <div class="input-group">
                                                        <select id="SlctBolsa" class="form-control" style="font-size: 80%;">
														</select>
                                                    </div>
                                                </div>
												<div class="col-sm-2 my-1">
   												<label>Moeda</label>
                                                    <div class="input-group">
                                                        <select id="SlctMoeda" class="form-control" style="font-size: 80%;">
														</select>
                                                    </div>
                                                </div>
												<div class="col-sm-2 my-1">
   												<label>Dias no ano</label>
                                                    <div class="input-group">
														<select id="SlctDiasAno" class="form-control" style="font-size: 80%;">
															<option>252</option>
															<option>365</option>
														</select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 my-1">
   												<label>Tipo</label>
                                                    <div class="input-group">
                                                    <select id="SlctTipo" class="form-control" style="font-size: 80%;">
														</select>
                                                    </div>
                                                </div>
												<div class="col-sm-2 my-1">
   												<label>DU ou DC</label>
                                                    <div class="input-group">
														<select id="SlctDUouDC" class="form-control" style="font-size: 80%;">
															<option>DU</option>
															<option>DC</option>
														</select>
                                                    </div>
                                                </div>

                                                <div class="col-sm-6 my-1">
                                                    <label>Indice</label>
                                                     <div class="input-group">
                                                         <select id="SlctIndice" class="form-control" style="font-size: 80%;" onchange="PossibilidadesIndices(this.value)" >
															<option selected disabled >Selecione</option>
                                                             <option value = "IPCA" >IPCA</option>
                                                             <option value = "CDI" >CDI</option>
                                                             <option value = "PRE" >PRE</option>
                                                             <option value = "IGP-M"  >IGP-M</option>
                                                         </select>
                                                     </div>
                                                 </div>

												<div class="col-sm-6 my-1">
   												<label>Indexação</label>
                                                    <div class="input-group">
														<select id="SlctIndexacao" class="form-control" style="font-size: 80%;" onchange="PossibilidadesIndexacao(this.value)" >
															<option selected disabled >Selecione</option>
                                                            <option value = "% do Indice" >% do Indice</option>
															<option value = "Indice + Spread" >Indice + Spread</option>
                                                        </select>
                                                    </div>
                                                </div>

												<div class="col-sm-12 my-1">
   												<label>Emissor</label>
                                                    <div class="input-group">
                                                    <select id="SlctEmissor" class="form-control" style="font-size: 80%;">
														</select>
                                                    </div>
                                                </div>

												<div class="col-sm-4 my-1">
   												<label>Agencia Rating Emissão</label>
                                                    <div class="input-group">
														<select id="SlctAgenciaRatingEmissao" class="form-control" style="font-size: 80%;">
															<option>Moodys</option>
															<option>SeP</option>
															<option>Fitch</option>
														</select>
                                                    </div>
                                                </div>

												<div class="col-sm-4 my-1">
   												<label>Rating Emissão</label>
                                                    <div class="input-group">
														<select id="SlctRatingEmissao" class="form-control" style="font-size: 80%;">
                                                        <option>AAA(bra)</option>
                                                        <option>AA+(bra)</option>
                                                        <option>AA(bra)</option>
                                                        <option>AA-(bra)</option>
                                                        <option>A+(bra)</option>
                                                        <option>A(bra)</option>
                                                        <option>A-(bra)</option>
                                                        <option>BBB+(bra)</option>
                                                        <option>BBB(bra)</option>
                                                        <option>BBB-(bra)</option>
                                                        <option>BB+(bra)</option>
                                                        <option>BB(bra)</option>
                                                        <option>BB-(bra)</option>
                                                        <option>B+(bra)</option>
                                                        <option>B(bra)</option>
                                                        <option>B-(bra)</option>
                                                        <option>CCC+(bra)</option>
                                                        <option>CCC(bra)</option>
                                                        <option>CCC-(bra)</option>
                                                        <option>Aaa.br</option>
                                                        <option>Aa1.br</option>
                                                        <option>Aa2.br</option>
                                                        <option>Aa3.br</option>
                                                        <option>A1.br</option>
                                                        <option>A2.br</option>
                                                        <option>A3.br</option>
                                                        <option>Baa1.br</option>
                                                        <option>Baa2.br</option>
                                                        <option>Baa3.br</option>
                                                        <option>Ba1.br</option>
                                                        <option>Ba2.br</option>
                                                        <option>Ba3.br</option>
                                                        <option>B1.br</option>
                                                        <option>B2.br</option>
                                                        <option>B3.br</option>
                                                        <option>Caa1.br</option>
                                                        <option>Caa2.br</option>
                                                        <option>Caa3.br</option>
                                                        <option>brAAA</option>
                                                        <option>brAA+</option>
                                                        <option>brAA</option>
                                                        <option>brAA-</option>
                                                        <option>brA+</option>
                                                        <option>brA</option>
                                                        <option>brA-</option>
                                                        <option>brBBB+</option>
                                                        <option>brBBB</option>
                                                        <option>brBBB-</option>
                                                        <option>brBB+</option>
                                                        <option>brBB</option>
                                                        <option>brBB-</option>
                                                        <option>brB+</option>
                                                        <option>brB</option>
                                                        <option>brB-</option>
                                                        <option>brCCC+</option>
                                                        <option>brCCC</option>
                                                        <option>brCCC-</option>
                                                        </select>
                                                    </div>
                                                </div>

												<div class="col-sm-4 my-1">
   												<label>Rating Emissão MAI</label>
                                                    <div class="input-group">
														<select id="SlctRatingEmissaoMAI" class="form-control" style="font-size: 80%;">
															<option>AAA</option>
															<option>AA</option>
															<option>A</option>
															<option>BBB</option>
															<option>BB</option>
															<option>B</option>
															<option>CCC</option>
															<option>CC</option>
															<option>C</option>
                                                        </select>
                                                    </div>
                                                </div>												


												
											</div>
										 
<!-- Formulario  Others-->
				 
											 <div class="form-row align-items-center">
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Vencimento</div></div>
                                                        <input class="form-control" type="date" value="" id="tbVencimento" >
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Emissão</div></div>
                                                        <input class="form-control" type="date" value="" id="tbEmissao" >
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Carência Juros</div></div>
                                                        <input class="form-control" type="date" value="" id="tbCarenciaJuros" >
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Carência</div></div>
                                                        <input class="form-control" type="date" value="" id="tbCarencia" >
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Data Inicio Rent.</div></div>
                                                        <input class="form-control" type="date" value="" id="tbDataInicioRentabilidade" >
                                                    </div>
                                                </div>

                                                <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Defasagem</div></div>
                                                        <input type="text" class="form-control" id="tbDefasagemIndice" placeholder="" value='0'  onkeyup="IntOnly(this.id)">
                                                    </div>
                                                </div>

                                               <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Aditivo Indice</div></div>
                                                        <input type="text" class="form-control" id="tbAditivoIndice" placeholder="Ex : 5,2% (Para CDI + 5,2% )" onkeyup="NumberOnlyPerc(this.id)">
                                                    </div>
                                                </div>
                                               <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">Percentual Indice</div></div>
                                                        <input type="text" class="form-control" id="tbPercIndice" placeholder="Ex : 120% (Para 120% do CDI)" onkeyup="NumberOnlyPerc(this.id)">
                                                    </div>
                                                </div>

                                                <div class="col-sm-12 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">Utilize % quando cadastrar aditivos e percentuais de Indices!</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text"> EX: CDI+5%, Precentual Indice:100% e Aditivo Indice:5% </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text"> EX: 120%CDI, Precentual Indice:120% e Aditivo Indice:0% </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                




                                               <div class="col-sm-6 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend"><div class="input-group-text">VNE</div></div>
                                                        <input type="text" class="form-control" id="tbValorNominalEmissao" placeholder="Ex : 1.0000,00" onkeyup="NumberOnly(this.id)">
                                                    </div>
                                                </div>


                                            </div>
										 
                                            <div>
                                                <a id="submit-btn-area-a" style="margin:10px 10px 0px 0px;width:150px;float:right;" onClick="Update()" >Salvar</a>
                                                <a id="submit-btn-area-a" style="margin:10px 10px 0px 0px;width:150px;float:right;" onClick="Insert()" >Novo</a>
                                            </div>
                                        </form>



                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



					<div class="col-lg-6 col-ml-12">
                        <div class="row">
                            <div class="col-12 mt-5">
                                <div class="card">
                                    <div class="card-body">
									
	
	                           <!-- Listbox Formulario -->							
                                                         <div class="search-box pull-left" style = "margin:0px 0px 20px 0px;">
                                                                                <form action="#">
                                                                                    <input type="text" id="TbSearch" name="search" placeholder="Search..." required>
                                                                                    <a style="cursor:pointer;" OnClick="CarregaBusca()"><i class="ti-search"></i></a>
                                                                                </form>
                                                                            </div>
                            
                                                                            <input id="hfPage" type="hidden">
                                                                            <input id="hfnPages" type="hidden">
                                                                            <div class="pull-right" style = "margin:0px 0px 50px 0px;" >									
                                                                                        <nav aria-label="Page navigation example">
                                                                                            <ul class="pagination justify-content-end">
                                                                                                 <li class="page-item">
                                                                                                    <a class="page-link" OnClick="Anterior()">Anterior</a>
                                                                                                </li>
                                                                                                <li class="page-item"><a id="LblDisplayPage" class="page-link" href="#">-</a></li>
                                                                                                <li class="page-item">
                                                                                                    <a class="page-link" OnClick="Proximo()">Próxima</a>
                                                                                                </li>
                                                                                            </ul>
                                                                                        </nav>
                                                                                </div>
                                                                    
                                                                    
                                                                            <div class="single-table">
                                                                                    <div class="table-responsive">
                                                                                        <table class="table text-center">
                                                                                            <thead class="text-uppercase">
                                                                                                <tr>
                                                                                                    <th scope="col">Alias</th>
                                                                                                    <th scope="col">Emissor</th>
                                                                                                    <th scope="col">Isin</th>
                                                                                                    <th scope="col"></th>
                                                                                                    <th scope="col"></th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody id="TblDados">
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                    
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


					
<div class="col-lg-6 col-ml-12">
      <div class="row">
					<div class="col-lg-12 mt-5">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="header-title">Fluxo de Caixa do Papel</h4>

                                            <div>
                                                <a id="submit-btn-area-a" onClick="ShowModalFluxoNovo()" style = "width:100px;margin:10px 10px 10px 10px;float:right;">Novo</a>
                                                <a id="submit-btn-area-a" onClick="DeleteAllFlux()" style = "width:100px;margin:10px 10px 10px 10px;float:right;" >Deleta Fluxo</a>
                                                <a id="submit-btn-area-a" onClick="MontaFluxoBullet()" style = "width:150px;margin:10px 10px 10px 10px;float:right;" >Mota Fluxo Bullet</a>
                                            </div>

                                <div class="single-table">
                                    <div class="table-responsive">
                                        <table class="table text-center">
                                            <thead class="text-uppercase">
                                                <tr>
                                                    <th scope="col">Data</th>
                                                    <th scope="col">Tipo Evento</th>
                                                    <th scope="col">Perc Evento</th>
                                                    <th scope="col">Incidencia</th>
                                                    <th scope="col"></th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody id="TblFluxo">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
 
 
 
 
                                <div class="modal fade bd-example-modal-lg" id="ModalFluxoBox" Name="ModalFluxoBox">
                                    <input id="hflocalidfluxo" type="hidden" value='' ></input>
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                        <div class="modal-header">
                                                <h5 class="modal-title">Edição de Eventos</h5>
                                                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                                            </div>
                                            <div class="modal-body">

											<form>
                                            <div class="form-row align-items-center">
                                            <div class="col-sm-3 my-1">
   												<label>Data</label>
                                                    <div class="input-group">
                                                        <input class="form-control" type="date" value="2018-03-05" id="tbData" >
                                                    </div>
                                            </div>
											<div class="col-sm-3 my-1">
   												<label>Perc Evento</label>
													<div class="input-group">
                                                        <input type="text" class="form-control" id="tbPercEvento" value="0" onkeyup="NumberOnlyPerc(this.id)">
													</fieldset>
												</div>
											</div>	
											<div class="col-sm-3 my-1">
   												<label>Valor</label>
													<div class="input-group">
                                                        <input type="text" class="form-control" id="tbValorLiq" value="0" onkeyup="NumberOnly(this.id)">
													</fieldset>
												</div>
											</div>	
												<div class="col-sm-3 my-1">
   												<label>Tipo Evento</label>
                                                    <div class="input-group">
														<select id="SlctTipoEvento" class="form-control" style="font-size: 80%;">
															<option>Juros</option>
															<option>Amortização</option>
															<option>Amortização Extraordinaria</option>
														</select>
                                                    </div>
                                                </div>	
												<div class="col-sm-12 my-1">
   												<label>Tipo Incidencia</label>
                                                    <div class="input-group">
														<select id="SlctTipoIncidencia" class="form-control" style="font-size: 80%;" onchange="ajustaformflux(this.value)">
															<option value = "% Saldo Devedor" >% Saldo Devedor</option>
															<option value = "%VNA" >%VNA</option>
															<option value = "%VNE" >%VNE</option>
															<option value = "Valor Fixo" >Valor Fixo</option>
                                                        </select>
                                                    </div>
                                                </div>	
                                                <div class="col-sm-12 my-1">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">Utilize % quando cadastrar percentuais do evento!</div>
                                                        </div>
                                                    </div>
                                                </div>
               								
                                            </div>
												
											</form>


                                            </div>
                                            <div >
                                                <a id="submit-btn-area-a" onClick="UpdateFlux()" style = "width:100px;margin:10px 10px 10px 10px;float:right;" >Grava</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
		</div>
</div>
					
					
					
					
                </div>

            </div>
        </div>
		
		
		
		
		
        <footer>
            <div class="footer-area">
                <p>© Versão Beta</p>
            </div>
        </footer>
    </div>
    
    
    <script src="../static/js/modernizr-2.8.3.min.js"></script>
    <script src="../static/js/jquery-2.2.4.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/metisMenu.min.js"></script>
    <script src="../static/js/jquery.slimscroll.min.js"></script>
    <script src="../static/js/jquery.slicknav.min.js"></script>
    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/scripts.js"></script>



    <script>
        var jsonData = JSON.parse('{{ jsnDt | tojson | safe}}');

        var ListaBolsa = jsonData['ListaBolsa']
        var z = document.createElement('option'); // is a node
            z.innerHTML = 'Selecione a Bolsa...';
            z.setAttribute('disabled',true)
            z.setAttribute('selected',true)
            document.getElementById('SlctBolsa').appendChild(z) 
        for (var key in ListaBolsa) {
            var z = document.createElement('option'); // is a node
            z.innerHTML = ListaBolsa[key] ;
            z.setAttribute('value',key)
            document.getElementById('SlctBolsa').appendChild(z) 
        }

        var ListaMoeda = jsonData['ListaMoeda']
        var z = document.createElement('option'); // is a node
            z.innerHTML = 'Selecione uma Moeda...';
            z.setAttribute('disabled',true)
            z.setAttribute('selected',true)
            document.getElementById('SlctMoeda').appendChild(z) 
        for (var key in ListaMoeda) {
            var z = document.createElement('option'); // is a node
            z.innerHTML = ListaMoeda[key];
            z.setAttribute('value',key)
            document.getElementById('SlctMoeda').appendChild(z) 
        }

        var ListaTipoMercadoriaRF = jsonData['ListaTipoMercadoriaRF']
        var z = document.createElement('option'); // is a node
            z.innerHTML = 'Selecione uma Mercadoria...';
            z.setAttribute('disabled',true)
            z.setAttribute('selected',true)
            document.getElementById('SlctTipo').appendChild(z) 
        for (var key in ListaTipoMercadoriaRF) {
            var z = document.createElement('option'); // is a node
            z.innerHTML = key;
            z.setAttribute('value',ListaTipoMercadoriaRF[key])
            document.getElementById('SlctTipo').appendChild(z) 
        }

        var ListaDictEmissor = jsonData['ListaDictEmissor']
        var z = document.createElement('option'); // is a node
            z.innerHTML = 'Selecione um Emissor...';
            z.setAttribute('disabled',true)
            z.setAttribute('selected',true)
            document.getElementById('SlctEmissor').appendChild(z) 
        for (var key in ListaDictEmissor) {
            var z = document.createElement('option'); // is a node
            z.innerHTML = key;
            z.setAttribute('value',ListaDictEmissor[key])
            document.getElementById('SlctEmissor').appendChild(z) 
        }

        var UserName = document.getElementById('hfHeaderUserName').value;
        var picturepath = document.getElementById('hfpicture').value;
        document.getElementById('imgProfile').src = picturepath;
        document.getElementById('NameUser').innerHTML = UserName + "<i class='fa fa-angle-down'></i>";
    </script>
    
<script> 


function DeleteAllFlux(){
document.getElementById("hfFlux").value='[]';
Montatbleventos()
}


function Montatbleventos(){
    var events = JSON.parse(document.getElementById("hfFlux").value);
                var Tbl = document.getElementById("TblFluxo");
                while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}
                Tbl.innerhtml = "";
                for (k in events){
                        var Header = document.createElement('tr');
                        Header.setAttribute('class',"heading-td")
                        Header.setAttribute('id',k);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = events[k]["Data"];Header.appendChild(HeaderCol);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = events[k]["TipoEvento"];Header.appendChild(HeaderCol);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = float_to_taxa_brl(events[k]["PercEvento"]);Header.appendChild(HeaderCol);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = events[k]["TipoIncidencia"];Header.appendChild(HeaderCol);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="Deleteflx#'+k+'" onClick="DeleteFlux(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                        var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="Displayflx#'+k+'" onClick="DisplayFlux(this.id)"><i class="ti-eye"></i></a>';Header.appendChild(HeaderCol);
                        Tbl.appendChild(Header);
                }    
}



function PossibilidadesIndices(valor){
    console.log('Entrou possibilidade Indices');
    var slct = document.getElementById("SlctIndexacao");
    var indx = document.getElementById("SlctIndice");
    document.getElementById("tbPercIndice").disabled = false;
    document.getElementById("tbAditivoIndice").disabled = false;
    while (slct.lastElementChild) {slct.removeChild(slct.lastElementChild);}
    if(valor=="PRE"){
        var z = document.createElement('option');
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        slct.appendChild(z) ;
        var z = document.createElement('option');
        z.innerHTML = 'Indice + Spread';
        slct.appendChild(z) ;
    }else if(valor=="IPCA"){
        var z = document.createElement('option');
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        slct.appendChild(z) ;
        var z = document.createElement('option');
        z.innerHTML = 'Indice + Spread';
        slct.appendChild(z);
    }else if(valor=="CDI"){
//        var slct = document.getElementById("SlctIndexacao");
        var z = document.createElement('option');
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        slct.appendChild(z) ;
        var z = document.createElement('option');
        z.innerHTML = 'Indice + Spread';
        slct.appendChild(z);         
        var z = document.createElement('option');
        z.innerHTML = '% do Indice';
        slct.appendChild(z);         
    }else if(valor=="IGP-M"){
        var z = document.createElement('option');
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true);
        z.setAttribute('selected',true);
        slct.appendChild(z) ;
        var z = document.createElement('option');
        z.innerHTML = 'Indice + Spread';
        slct.appendChild(z);         
    }
}

function PossibilidadesIndexacao(valor){
console.log('Entrou possibilidade indexacao');
var indx = document.getElementById("SlctIndice");
document.getElementById("tbPercIndice").disabled = false;
document.getElementById("tbAditivoIndice").disabled = false;
if(indx.value=="PRE"){
    document.getElementById("tbPercIndice").value = '0%';
    document.getElementById("tbPercIndice").disabled = true;
}else if(indx.value=="CDI"){
    if (valor == "% do Indice"){
        document.getElementById("tbAditivoIndice").value = '0%';
        document.getElementById("tbPercIndice").value = '';
        document.getElementById("tbAditivoIndice").disabled = true;
    }else if (valor == "Indice + Spread"){
        document.getElementById("tbPercIndice").value = '100%';
        document.getElementById("tbAditivoIndice").value = '';

        document.getElementById("tbPercIndice").disabled = true;
    }
}else if(indx.value=="IPCA"){
    document.getElementById("tbPercIndice").value = '100%';
    document.getElementById("tbPercIndice").disabled = true;
}else if(indx.value=="IGP-M"){
    document.getElementById("tbPercIndice").value ='100%';
    document.getElementById("tbPercIndice").disabled = true;
}
}

function Update(){
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

var ListaMoeda = jsonData['ListaMoeda']
var ListaBolsa = jsonData['ListaBolsa']


fd.append("IDRF", document.getElementById("tbIDRF").value);
fd.append("Codigo", document.getElementById("tbCodigo").value);
fd.append("Isin", document.getElementById("tbIsin").value);
fd.append("AgenteFiduciario", document.getElementById("tbAgenteFiduciario").value);
fd.append("CoordenadorLider", document.getElementById("tbCoordenadorLider").value);
fd.append("RegistroCVM", document.getElementById("cbRegistroCVM").checked);
fd.append("IncorporaJuros", document.getElementById("cbIncorporaJuros").checked);
fd.append("ResgateAntecipado", document.getElementById("cbResgateAntecipado").checked);
fd.append("EmDefault", document.getElementById("cbEmDefault").checked);
fd.append("Coobrigacao", document.getElementById("cbCoobrigacao").checked);
fd.append("Incentivada", document.getElementById("cbIncentivada").checked);
fd.append("idBolsa", document.getElementById("SlctBolsa").value);
fd.append("idMoeda", document.getElementById("SlctMoeda").value);
fd.append("idTipoRF", document.getElementById("SlctTipo").value);
fd.append("idEmissor", document.getElementById("SlctEmissor").value);
fd.append("DiasAno", document.getElementById("SlctDiasAno").value);
fd.append("DUouDC", document.getElementById("SlctDUouDC").value);
fd.append("Indexacao", document.getElementById("SlctIndexacao").value);
fd.append("Indice", document.getElementById("SlctIndice").value);
fd.append("AgenciaRatingEmissao", document.getElementById("SlctAgenciaRatingEmissao").value);
fd.append("RatingEmissao", document.getElementById("SlctRatingEmissao").value);
fd.append("RatingEmissaoMAI", document.getElementById("SlctRatingEmissaoMAI").value);
fd.append("Vencimento", document.getElementById("tbVencimento").value);
fd.append("DataInicioRentabilidade", document.getElementById("tbDataInicioRentabilidade").value);
fd.append("Carencia", document.getElementById("tbCarencia").value);
fd.append("CarenciaJuros", document.getElementById("tbCarenciaJuros").value);
fd.append("Emissao", document.getElementById("tbEmissao").value);
fd.append("AditivoIndice", taxa_to_float(document.getElementById("tbAditivoIndice").value));
fd.append("PercIndice", taxa_to_float(document.getElementById("tbPercIndice").value));
fd.append("DefasagemIndice", document.getElementById("tbDefasagemIndice").value);
fd.append("ValorNominalEmissao", document.getElementById("tbValorNominalEmissao").value);
fd.append("Alias", "RF#"+ListaMoeda[document.getElementById("SlctMoeda").value]+ListaBolsa[document.getElementById("SlctBolsa").value]+"@"+document.getElementById("tbCodigo").value);
fd.append("Events",document.getElementById("hfFlux").value);


var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Update",true);
oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){
                window.location.href = "/Login";
            }
            else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);
}

function Insert(){
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );


var ListaMoeda = jsonData['ListaMoeda']
var ListaBolsa = jsonData['ListaBolsa']


fd.append("IDRF", document.getElementById("tbIDRF").value);
fd.append("Codigo", document.getElementById("tbCodigo").value);
fd.append("Isin", document.getElementById("tbIsin").value);
fd.append("AgenteFiduciario", document.getElementById("tbAgenteFiduciario").value);
fd.append("CoordenadorLider", document.getElementById("tbCoordenadorLider").value);
fd.append("RegistroCVM", document.getElementById("cbRegistroCVM").checked);
fd.append("IncorporaJuros", document.getElementById("cbIncorporaJuros").checked);
fd.append("ResgateAntecipado", document.getElementById("cbResgateAntecipado").checked);
fd.append("EmDefault", document.getElementById("cbEmDefault").checked);
fd.append("Coobrigacao", document.getElementById("cbCoobrigacao").checked);
fd.append("Incentivada", document.getElementById("cbIncentivada").checked);
fd.append("idBolsa", document.getElementById("SlctBolsa").value);
fd.append("idMoeda", document.getElementById("SlctMoeda").value);
fd.append("idTipoRF", document.getElementById("SlctTipo").value);
fd.append("idEmissor", document.getElementById("SlctEmissor").value);
fd.append("DiasAno", document.getElementById("SlctDiasAno").value);
fd.append("DUouDC", document.getElementById("SlctDUouDC").value);
fd.append("Indexacao", document.getElementById("SlctIndexacao").value);
fd.append("Indice", document.getElementById("SlctIndice").value);
fd.append("AgenciaRatingEmissao", document.getElementById("SlctAgenciaRatingEmissao").value);
fd.append("RatingEmissao", document.getElementById("SlctRatingEmissao").value);
fd.append("RatingEmissaoMAI", document.getElementById("SlctRatingEmissaoMAI").value);
fd.append("Vencimento", document.getElementById("tbVencimento").value);
fd.append("DataInicioRentabilidade", document.getElementById("tbDataInicioRentabilidade").value);
fd.append("Carencia", document.getElementById("tbCarencia").value);
fd.append("CarenciaJuros", document.getElementById("tbCarenciaJuros").value);
fd.append("Emissao", document.getElementById("tbEmissao").value);
fd.append("AditivoIndice", taxa_to_float(document.getElementById("tbAditivoIndice").value));
fd.append("PercIndice", taxa_to_float(document.getElementById("tbPercIndice").value));
fd.append("DefasagemIndice", document.getElementById("tbDefasagemIndice").value);
fd.append("ValorNominalEmissao", document.getElementById("tbValorNominalEmissao").value);
fd.append("Alias", "RF#"+ListaMoeda[document.getElementById("SlctMoeda").value]+ListaBolsa[document.getElementById("SlctBolsa").value]+"@"+document.getElementById("tbCodigo").value);
fd.append("Events",document.getElementById("hfFlux").value);


var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Insert",true);
oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";}
            else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);
}


function CarregaBusca(){
document.getElementById("hfPage").value = 1;
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("TbSearch").value);
fd.append("Pag", 1);
fd.append("nPerPag", 10);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Search",true);
oReq.onload = function() {
                                var result = JSON.parse(this.responseText);  
                                var Tbl = document.getElementById("TblDados");
                                while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
                                Tbl.innerhtml = "";
                                var result = JSON.parse(this.responseText);    
                                if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
                                if (trim(result['resposta']) != trim("Ok"))
                                {document.getElementById("LblDisplayPage").innerText='-';throw new Error(trim(result['resposta']));exit;}
                                else{
                                    var Dados=result['Dados'];
                                    document.getElementById("hfnPages").value = Dados["nPags"];
                                    document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
                                    for (k in Dados["Lista"]) {
                                                                var Header = document.createElement('tr');
                                                                Header.setAttribute('class',"heading-td")
                                                                Header.setAttribute('id',k);
                                                                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                                                                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["EmissorNome"];Header.appendChild(HeaderCol);
                                                                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Isin"];Header.appendChild(HeaderCol);
                                                                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                                                                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DisplayObj#'+k+'" onClick="Display(this.id)"><i class="ti-eye"></i></a>';Header.appendChild(HeaderCol);
                                                                Tbl.appendChild(Header);
                                                                }
                                }
                            }
oReq.send(fd);
}


function Display(s){
var idLista = document.getElementById(s).id;
var fd = new FormData();
fd.append("IDRF", trim(Right(idLista,idLista.length-idLista.search("#")-1)));
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Load",true);
oReq.onload = function() {
                            var result = JSON.parse(this.responseText); 
                            var slct = document.getElementById("SlctIndexacao");
                            while (slct.lastElementChild) {slct.removeChild(slct.lastElementChild);}
                            var z = document.createElement('option');
                            z.innerHTML = 'Selecione...';
                            z.setAttribute('disabled',true);
                            z.setAttribute('selected',true);
                            slct.appendChild(z) ;
                            var z = document.createElement('option');
                            z.innerHTML = 'Indice + Spread';
                            slct.appendChild(z);         
                            var z = document.createElement('option');
                            z.innerHTML = '% do Indice';
                            slct.appendChild(z);     
                            if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
                            if (trim(result['resposta']) != trim("Ok")){throw new Error(trim(result['resposta']));exit;}
                            else{
                                var Dados=result['Dados'];
                                document.getElementById("tbIDRF").value = Dados["IDRF"];
                                document.getElementById("tbAlias").value = Dados["Alias"];
                                document.getElementById("tbCodigo").value = Dados["Codigo"];
                                document.getElementById("tbIsin").value = Dados["Isin"];
                                document.getElementById("tbAgenteFiduciario").value = Dados["AgenteFiduciario"];
                                document.getElementById("tbCoordenadorLider").value = Dados["CoordenadorLider"];
                                document.getElementById("cbRegistroCVM").checked = Dados["RegistroCVM"];
                                document.getElementById("cbIncorporaJuros").checked = Dados["IncorporaJuros"];
                                document.getElementById("cbResgateAntecipado").checked = Dados["ResgateAntecipado"];
                                document.getElementById("cbEmDefault").checked = Dados["EmDefault"];
                                document.getElementById("cbCoobrigacao").checked = Dados["Coobrigacao"];
                                document.getElementById("cbIncentivada").checked = Dados["Incentivada"];
                                document.getElementById("SlctBolsa").value = Dados["idBolsa"];
                                document.getElementById("SlctMoeda").value = Dados["idMoeda"];
                                document.getElementById("SlctTipo").value = Dados["idTipoRF"];
                                document.getElementById("SlctEmissor").value = Dados["idEmissor"];
                                document.getElementById("SlctDiasAno").value = Dados["DiasAno"];
                                document.getElementById("SlctDUouDC").value = Dados["DUouDC"];
                                if("% do INDICE"==Dados["Indexacao"]){document.getElementById("SlctIndexacao").value = "% do Indice";}else{document.getElementById("SlctIndexacao").value = Dados["Indexacao"];}
                                document.getElementById("SlctIndice").value = Dados["Indice"];
                                document.getElementById("SlctAgenciaRatingEmissao").value = Dados["AgenciaRatingEmissao"];
                                document.getElementById("SlctRatingEmissao").value = Dados["RatingEmissao"];
                                var Nota;
                                Nota = 20;
                                if("AAA(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 19;}
                                if("AA+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 18;}
                                if("AA(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 17;}
                                if("AA-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 16;}
                                if("A+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 15;}
                                if("A(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 14;}
                                if("A-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 13;}
                                if("BBB+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 12;}
                                if("BBB(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 11;}
                                if("BBB-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 10;}
                                if("BB+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 9;}
                                if("BB(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 8;}
                                if("BB-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 7;}
                                if("B+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 6;}
                                if("B(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 5;}
                                if("B-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 4;}
                                if("CCC+(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 3;}
                                if("CCC(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 2;}
                                if("CCC-(bra)"==document.getElementById("SlctRatingEmissao").value){Nota = 1;}
                                if("Aaa.br"==document.getElementById("SlctRatingEmissao").value){Nota = 19;}
                                if("Aa1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 18;}
                                if("Aa2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 17;}
                                if("Aa3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 16;}
                                if("A1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 15;}
                                if("A2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 14;}
                                if("A3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 13;}
                                if("Baa1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 12;}
                                if("Baa2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 11;}
                                if("Baa3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 10;}
                                if("Ba1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 9;}
                                if("Ba2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 8;}
                                if("Ba3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 7;}
                                if("B1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 6;}
                                if("B2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 5;}
                                if("B3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 4;}
                                if("Caa1.br"==document.getElementById("SlctRatingEmissao").value){Nota = 3;}
                                if("Caa2.br"==document.getElementById("SlctRatingEmissao").value){Nota = 2;}
                                if("Caa3.br"==document.getElementById("SlctRatingEmissao").value){Nota = 1;}
                                if("brAAA"==document.getElementById("SlctRatingEmissao").value){Nota = 19;}
                                if("brAA+"==document.getElementById("SlctRatingEmissao").value){Nota = 18;}
                                if("brAA"==document.getElementById("SlctRatingEmissao").value){Nota = 17;}
                                if("brAA-"==document.getElementById("SlctRatingEmissao").value){Nota = 16;}
                                if("brA+"==document.getElementById("SlctRatingEmissao").value){Nota = 15;}
                                if("brA"==document.getElementById("SlctRatingEmissao").value){Nota = 14;}
                                if("brA-"==document.getElementById("SlctRatingEmissao").value){Nota = 13;}
                                if("brBBB+"==document.getElementById("SlctRatingEmissao").value){Nota = 12;}
                                if("brBBB"==document.getElementById("SlctRatingEmissao").value){Nota = 11;}
                                if("brBBB-"==document.getElementById("SlctRatingEmissao").value){Nota = 10;}
                                if("brBB+"==document.getElementById("SlctRatingEmissao").value){Nota = 9;}
                                if("brBB"==document.getElementById("SlctRatingEmissao").value){Nota = 8;}
                                if("brBB-"==document.getElementById("SlctRatingEmissao").value){Nota = 7;}
                                if("brB+"==document.getElementById("SlctRatingEmissao").value){Nota = 6;}
                                if("brB"==document.getElementById("SlctRatingEmissao").value){Nota = 5;}
                                if("brB-"==document.getElementById("SlctRatingEmissao").value){Nota = 4;}
                                if("brCCC+"==document.getElementById("SlctRatingEmissao").value){Nota = 3;}
                                if("brCCC"==document.getElementById("SlctRatingEmissao").value){Nota = 2;}
                                if("brCCC-"==document.getElementById("SlctRatingEmissao").value){Nota = 1;}

                                if (Nota == 19){document.getElementById("SlctRatingEmissaoMAI").value = "AAA";}
                                else if (Nota == 18){document.getElementById("SlctRatingEmissaoMAI").value = "AA";}
                                else if (Nota == 17){document.getElementById("SlctRatingEmissaoMAI").value = "AA";}
                                else if (Nota == 16){document.getElementById("SlctRatingEmissaoMAI").value = "AA";}
                                else if (Nota == 15){document.getElementById("SlctRatingEmissaoMAI").value = "A";}
                                else if (Nota == 14){document.getElementById("SlctRatingEmissaoMAI").value = "A";}
                                else if (Nota == 13){document.getElementById("SlctRatingEmissaoMAI").value = "A";}
                                else if (Nota == 12){document.getElementById("SlctRatingEmissaoMAI").value = "BBB";}
                                else if (Nota == 11){document.getElementById("SlctRatingEmissaoMAI").value = "BBB";}
                                else if (Nota == 10){document.getElementById("SlctRatingEmissaoMAI").value = "BBB";}
                                else if (Nota == 9){document.getElementById("SlctRatingEmissaoMAI").value = "BB";}
                                else if (Nota == 8){document.getElementById("SlctRatingEmissaoMAI").value = "BB";}
                                else if (Nota == 7){document.getElementById("SlctRatingEmissaoMAI").value = "BB";}
                                else if (Nota == 6){document.getElementById("SlctRatingEmissaoMAI").value = "B";}
                                else if (Nota == 5){document.getElementById("SlctRatingEmissaoMAI").value = "B";}
                                else if (Nota == 4){document.getElementById("SlctRatingEmissaoMAI").value = "B";}
                                else if (Nota == 3){document.getElementById("SlctRatingEmissaoMAI").value = "CCC";}
                                else if (Nota == 2){document.getElementById("SlctRatingEmissaoMAI").value = "CCC";}
                                else if (Nota == 1){document.getElementById("SlctRatingEmissaoMAI").value = "CCC";}
                                else {document.getElementById("SlctRatingEmissaoMAI").value = Dados["RatingEmissao"];}

                                if((Dados["Vencimento"])!=="1899-12-30" && (Dados["Vencimento"])!=="1900-01-01"){document.getElementById("tbVencimento").value = (Dados["Vencimento"]);}else{document.getElementById("tbVencimento").value = "";}
                                if((Dados["DataInicioRentabilidade"])!=="1899-12-30" && (Dados["DataInicioRentabilidade"])!=="1900-01-01"){document.getElementById("tbDataInicioRentabilidade").value = (Dados["DataInicioRentabilidade"]);}else{document.getElementById("tbDataInicioRentabilidade").value = "";}
                                if((Dados["Carencia"])!=="1899-12-30" && (Dados["Carencia"])!=="1900-01-01"){document.getElementById("tbCarencia").value = (Dados["Carencia"]);}else{document.getElementById("tbCarencia").value = "";}
                                if((Dados["CarenciaJuros"])!=="1899-12-30" && (Dados["CarenciaJuros"])!=="1900-01-01"){document.getElementById("tbCarenciaJuros").value = (Dados["CarenciaJuros"]);}else{document.getElementById("tbCarenciaJuros").value = "";}
                                if((Dados["Emissao"])!=="1899-12-30" && (Dados["Emissao"])!=="1900-01-01"){document.getElementById("tbEmissao").value = (Dados["Emissao"]);}else{document.getElementById("tbEmissao").value = "";}
                                document.getElementById("tbAditivoIndice").value = float_to_taxa_brl(Dados["AditivoIndice"]);
                                document.getElementById("tbPercIndice").value = float_to_taxa_brl(Dados["PercIndice"]);
                                document.getElementById("tbDefasagemIndice").value = Dados["DefasagemIndice"];
                                document.getElementById("tbValorNominalEmissao").value = vl_to_float_brl(Dados["ValorNominalEmissao"]);
                                document.getElementById('hfFlux').value = JSON.stringify(Dados['Eventos']);
                                Montatbleventos()
                           }
                          }
oReq.send(fd);
}

function Delete(s){
var idLista = document.getElementById(s).id;
var fd = new FormData();
fd.append("IDRF", trim(Right(idLista,idLista.length-idLista.search("#")-1)));
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
var oReq = new XMLHttpRequest();
        oReq.open('POST', "/Cadastro/RF/Delete",true);
        oReq.onload = function() {
                                        var result = JSON.parse(this.responseText); 
                                        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
                                        else{


                                            var Tbl = document.getElementById("TblDados");
                                                var vv = false;
                                                for (var i = 0, row; row = Tbl.rows[i]; i++) {
                                                    if (row.getAttribute('id') == trim(Right(idLista, idLista.length - idLista.search("#") - 1))) {
                                                        Tbl.deleteRow(i);
                                                    }
                                                }   

                                            
                                                var dvMdl = document.getElementById("tbModalMsgBox");
                                                while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                                                dvMdl.innerhtml = "";
                                                var span = document.createElement('span');
                                                span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                                                dvMdl.appendChild(span);
                                                span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                                                $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                                                return;
                                            }
                                   }
        oReq.send(fd);
}

function Proximo(){

if(parseFloat(document.getElementById("hfnPages").value) >= parseFloat(document.getElementById("hfPage").value)+1)
{document.getElementById("hfPage").value=parseFloat(document.getElementById("hfPage").value)+1;}

var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("TbSearch").value);
fd.append("Pag", document.getElementById("hfPage").value);
fd.append("nPerPag", 10);

var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Search",true);
oReq.onload = function() {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDados"); 
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {document.getElementById("LblDisplayPage").innerText='-';throw new Error(trim(result['resposta']));exit;}
        else{
            while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
            Tbl.innerhtml = "";
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                Header.setAttribute('class',"heading-td")
                Header.setAttribute('id',k);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["EmissorNome"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Isin"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DisplayObj#'+k+'" onClick="Display(this.id)"><i class="ti-eye"></i></a>';Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
                }
        }
    }
oReq.send(fd);
}

function Anterior(){

if(1 <= parseFloat(document.getElementById("hfPage").value)-1)
{document.getElementById("hfPage").value=parseFloat(document.getElementById("hfPage").value)-1;}
else{throw new Error("Não tem pagina menor que 1!");}

var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("TbSearch").value);
fd.append("Pag", document.getElementById("hfPage").value);
fd.append("nPerPag", 10);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/Search",true);
oReq.onload = function() {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDados"); 
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {document.getElementById("LblDisplayPage").innerText='-';throw new Error(trim(result['resposta']));exit;}
        else{
            while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
            Tbl.innerhtml = "";
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                Header.setAttribute('class',"heading-td")
                Header.setAttribute('id',k);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["EmissorNome"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Isin"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DisplayObj#'+k+'" onClick="Display(this.id)"><i class="ti-eye"></i></a>';Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
                }
        }
    }
oReq.send(fd);
}


function MontaFluxoBullet(){
FluxAll=[]
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("DataVencimento", document.getElementById("tbVencimento").value);
fd.append("DataInicioRentabilidade", document.getElementById("tbDataInicioRentabilidade").value);
fd.append("DiasAno", document.getElementById("SlctDiasAno").value);
fd.append("DataEmissao", document.getElementById("tbEmissao").value);
fd.append("Indice", document.getElementById("SlctIndice").value);
fd.append("Indexacao", document.getElementById("SlctIndexacao").value);
fd.append("PercIndice", taxa_to_float(document.getElementById("tbPercIndice").value));
fd.append("AditivoIndice", taxa_to_float(document.getElementById("tbAditivoIndice").value));
fd.append("idRF", document.getElementById("tbIDRF").value);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Cadastro/RF/MontaFluxoBullet",true);
oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";}
            else if (trim(result['resposta']) == trim("Ok"))
            {
                document.getElementById('hfFlux').value = JSON.stringify(result['Eventos']);
                Montatbleventos()
            }
            else
                {
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);
}

function ShowModalFluxo(){$(document).ready(function(){$('#ModalFluxoBox').modal('show');})}
function ShowModalFluxoNovo(){
document.getElementById("tbData").value = '';
document.getElementById("tbPercEvento").value = '0%';
document.getElementById("tbValorLiq").value = '0%';
document.getElementById("SlctTipoEvento").value = '';
document.getElementById("SlctTipoIncidencia").value = '';
document.getElementById("hflocalidfluxo").value = '';
document.getElementById("tbValorLiq").disabled = true;
$(document).ready(function(){$('#ModalFluxoBox').modal('show');})
}
function CloseModalFluxoNovo(){$(document).ready(function(){$('#ModalFluxoBox').modal('hide');})}

function DisplayFlux(id){
    localidfluxo = id.replace("Displayflx#","")    
    var events = JSON.parse(document.getElementById("hfFlux").value);
    var flx = events[localidfluxo]
    document.getElementById("tbValorLiq").disabled = false;
    document.getElementById("tbData").value = flx.Data
    document.getElementById("tbPercEvento").value = float_to_taxa_brl(flx.PercEvento);
    document.getElementById("tbValorLiq").value = flx.ValorLiq;
    document.getElementById("SlctTipoEvento").value = flx.TipoEvento;
    document.getElementById("SlctTipoIncidencia").value = flx.TipoIncidencia;
    if (flx.TipoIncidencia!='Valor Fixo'){document.getElementById("tbValorLiq").disabled = true;}
    document.getElementById("hflocalidfluxo").value = localidfluxo;
    ShowModalFluxo();
}    


function ajustaformflux(valor){
    if (valor!='Valor Fixo'){document.getElementById("tbValorLiq").disabled = true;document.getElementById("tbValorLiq").value=''}
    else{document.getElementById("tbValorLiq").disabled = false;}
}

function UpdateFlux(){
    if(document.getElementById("tbPercEvento").value==''){document.getElementById("tbPercEvento").value=0}
    if(document.getElementById("tbValorLiq").value==''){document.getElementById("tbValorLiq").value=0}
    document.getElementById("tbValorLiq").value = (document.getElementById("tbValorLiq").value)
    document.getElementById("tbPercEvento").value = taxa_to_float(document.getElementById("tbPercEvento").value)
    var events = JSON.parse(document.getElementById("hfFlux").value);
    var localidfluxo = ''
    if (document.getElementById("hflocalidfluxo").value==''){
        events.push({
            "Data":document.getElementById("tbData").value,
            "PercEvento": document.getElementById("tbPercEvento").value,
            "ValorLiq":document.getElementById("tbValorLiq").value,
            "TipoEvento":document.getElementById("SlctTipoEvento").value,
            "TipoIncidencia":document.getElementById("SlctTipoIncidencia").value
        })
    }
    else{
        localidfluxo = document.getElementById("hflocalidfluxo").value.replace("Displayflx#","")
        events[localidfluxo].Data = document.getElementById("tbData").value;
        events[localidfluxo].PercEvento = document.getElementById("tbPercEvento").value;
        events[localidfluxo].ValorLiq = document.getElementById("tbValorLiq").value;
        events[localidfluxo].TipoEvento = document.getElementById("SlctTipoEvento").value;
        events[localidfluxo].TipoIncidencia = document.getElementById("SlctTipoIncidencia").value;
    }  
    document.getElementById("hfFlux").value = JSON.stringify(events);
    CloseModalFluxoNovo();
    Montatbleventos()
}

function DeleteFlux(localid){
    var events = JSON.parse(document.getElementById("hfFlux").value);
    delete events[localid.replace("Deleteflx#","")]
    events = events.filter(function(e){return e}); 
    document.getElementById("hfFlux").value = JSON.stringify(events);
    Montatbleventos()
}    

function DeleteFluxAll(){
    document.getElementById('hfFlux').value = JSON.stringify([]);
    Montatbleventos()
}    

</script>

</body>

</html>
