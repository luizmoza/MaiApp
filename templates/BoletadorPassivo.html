<!DOCTYPE html>
<html class="no-js" lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>MaiApp - Boletador de Passivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="../static/images/icon/favicon.ico">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/css/themify-icons.css">
    <link rel="stylesheet" href="../static/css/metisMenu.css">
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/css/slicknav.min.css">
    <link rel="stylesheet" href="../static/css/typography.css">
    <link rel="stylesheet" href="../static/css/default-css.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/styles.css">

    <script src="../static/js/util.js"></script>

</head>

<body>

<input id="hfUsuario_Id" type="hidden" value='{{ Usuario_Id }}'>
<input id="hfUsuario_Email" type="hidden" value='{{ Usuario_Email }}'>
<input id="hfUsuario_Auth" type="hidden" value='{{ Usuario_Auth }}'>
<input id="hfpicture" type="hidden" value='{{ picture }}'>
<input id="hfHeaderUserName" type="hidden" value='{{ HeaderUserName }}'>
<input id="hfDadosCodRefs" type="hidden" value=''>



<div id="preloader">
    <div class="loader"></div>
</div>


<div class="modal fade" id="ModalMsgBox" Name="ModalMsgBox">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Mensagem</h5>
                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body" id="tbModalMsgBox" name="tbModalMsgBox" style="height:25vh;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="ModalPassiveBankDetails">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cadastrar dados bancários</h5>
                <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>

            <div class="modal-body" style="height:300px;" >
                <div class="row">
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label>Banco</label>
                            <input type="text" class="form-control input-custom" name="account_bank" placeholder="Banco" id="tbbanconovo"  >
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label>Agência</label>
                            <input type="text" class="form-control input-custom" name="account_agency" placeholder="Agência" id="tbagencianova"  >
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label>Conta</label>
                            <input type="text" class="form-control input-custom" name="account_name" placeholder="Conta" id="tbcontanova" >
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                    <a id="submit-btn-area-a" onclick="addPassiveBankDetails()">Nova</a>
            </div>

        </div>
    </div>
</div>





<div class="page-container">
    {{ SideBar }}
    <div class="main-content">
        {{ Header }}
     <div class="main-content-inner">
            <div class="row">
                <div class="col-lg-12 col-ml-12">
                    <div class="row">
                        <div class="col-12 mt-5">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title">Passivo</h4>
                                    <input disabled readonly type="hidden" class="form-control input-custom"
                                           id="IDCotista">
                                    <form id="form-passivo-helper">
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Data da Boleta</label>
                                                    <input class="form-control input-custom input-custom" type="date" value='{{ hoje }}' id="tbDataBoleta">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Alias Fundo</label>
                                                    <select id="SlctAliasPassivo" class="form-control input-custom input-custom" onchange="LoadCodigosCotista(this.value)">
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Tipo de Movimento</label>
                                                    <select id="SlctTipo" class="form-control input-custom input-custom" onchange="SetaForm(this.value)" ></select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Tipo de Liquidação</label>
                                                    <select id="SlctTipoLiquidacao"
                                                            class="form-control input-custom input-custom">
                                                        <option value="CETIP">CETIP</option>
                                                        <option value="TED">TED</option>
                                                        <option value="Conta Corrente">Conta Corrente</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Código de Cotista</label>
                                                    <select id="SlctCodigoCotista" onChange="LoadDadosCotista(this.value)" class="form-control input-custom input-custom">

                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Administrador</label>
                                                    <input disabled readonly type="text"
                                                           class="form-control input-custom" id="tbAdministrador">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Distribuidor</label>
                                                    <input disabled readonly type="text"
                                                           class="form-control input-custom" id="tbDistribuidor">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Nome Cotista</label>
                                                    <input disabled readonly type="text"
                                                           class="form-control input-custom" id="tbNomeCotista">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>CGC Fundo</label>
                                                    <input type="text"
                                                           class="form-control input-custom" id="tbCGCPassivo">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>CGC Cotista</label>
                                                    <input type="text"
                                                           class="form-control input-custom" id="tbCGCCotista">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Financeiro</label>
                                                    <input type="text" class="form-control input-custom"
                                                           id="tbFinanceiro" placeholder=""
                                                           onkeyup="NumberOnly(this.id)">
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Qtd de Cotas</label>
                                                    <input type="text" class="form-control input-custom" id="tbQtdCotas"
                                                           placeholder="" onkeyup="NumberOnly(this.id)">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Banco</label>
                                                    <input type="text" class="form-control input-custom"
                                                           id="account_bank" placeholder="Banco" readonly>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Agência</label>
                                                    <input type="text" class="form-control input-custom"
                                                           id="account_agency" placeholder="Agência" readonly>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <label>Conta</label>
                                                    <input type="text" class="form-control input-custom"
                                                           id="account_name" placeholder="Conta" readonly>
                                                </div>
                                                <select style="display: none" id="TypeOfAccount" name="TypeOfAccount"
                                                        class="form-control input-custom input-custom">
                                                    <option value="">Selecione</option>
                                                </select>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <h4 class="header-title">Contas</h4>
                                                <table class="table" id="tblcontas">
                                                    <thead>
                                                    <tr>
                                                        <th>Nome</th>
                                                        <th>CGC</th>
                                                        <th>Tipo</th>
                                                        <th>Banco</th>
                                                        <th>Agência</th>
                                                        <th>Conta</th>
                                                        <th>Dígito</th>
                                                        <th>#</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <a id="submit-btn-area-a" style="margin:10px 10px 0px 0px;width:150px;float:right;" onClick="Insert()">Boletar</a>
                                                <a id="submit-btn-area-a" style="margin:10px 10px 0px 0px;width:300px;float:right;" onClick="ShowPassiveBankDetails()">Cadastrar Dados Bancários</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12 col-ml-12">
                    <div class="row">
                        <div class="col-12 mt-5">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label>Início</label>
                                                <input class="form-control input-custom input-custom" type="date" id="tbDataIni" value = '{{ hoje }}' >
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label>Fim</label>
                                                <input class="form-control input-custom input-custom" type="date" value = '{{ hoje }}' id="tbDataFim">
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label for="filter_search">Tipo</label>
                                                <select id="filter_search" name="filter_search" class="form-control input-custom input-custom">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="form-group">
                                                <label>&nbsp;</label>
                                                <div class="input-wrapper">
                                                    <input placeholder="Search..." required class="form-control input-custom" type="text" id="tbSearch" name="search">
                                                    <label style="cursor:pointer;" OnClick="CarregaBusca()" for="search" class="fa fa-search input-icon"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input id="hfPage" type="hidden">
                                    <input id="hfnPages" type="hidden">
                                    <div class="pull-right" style="margin:0px 0px 50px 0px;">
                                        <nav aria-label="Page navigation example">
                                            <ul class="pagination justify-content-end">
                                                <li class="page-item">
                                                    <a class="page-link" OnClick="Anterior()">Anterior</a>
                                                </li>
                                                <li class="page-item">
                                                    <a id="LblDisplayPage" class="page-link" href="#">-</a>
                                                </li>
                                                <li class="page-item">
                                                    <a class="page-link" OnClick="Proximo()">Próxima</a>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                    <div class="single-table">
                                        <div class="table-responsive">
                                            <table class="table text-center">
                                                <thead>
                                                <tr>
                                                    <th>Tipo Movimento</th>
                                                    <th>Alias Fundo</th>
                                                    <th>Codigo Cotista</th>
                                                    <th>Data Cotização</th>
                                                    <th>Data Liquidação</th>
                                                    <th>Qtd de Cotas</th>
                                                    <th>Financeiro</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                                <tbody id="TblDados"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row" id="export-contents" style="display: none">
                                        <div class="col-lg-12">
                                            <a id="submit-btn-area-a"
                                               style="margin:20px 0;width:150px;float:right;"
                                               onClick="ExportContents()">Exportar</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        <footer>
            <div class="footer-area">
                <p>© Versão Beta</p>
            </div>
        </footer>
    </div>
    

    <script src="../static/js/modernizr-2.8.3.min.js"></script>
    <script src="../static/js/jquery-2.2.4.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/metisMenu.min.js"></script>
    <script src="../static/js/jquery.slimscroll.min.js"></script>
    <script src="../static/js/jquery.slicknav.min.js"></script>
    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/scripts.js"></script>



    <script>
        var jsonData = JSON.parse('{{ jsnDt | tojson | safe}}');
        var ListaFundoInterno = jsonData['ListaFundoInterno']
        var z = document.createElement('option'); // is a node
            z.innerHTML = 'Selecione...';
            z.setAttribute('disabled',true)
            z.setAttribute('selected',true)
            z.setAttribute('value','')
            document.getElementById('SlctAliasPassivo').appendChild(z) 
        for (var key in ListaFundoInterno) {
            var z = document.createElement('option'); // is a node
            z.innerHTML = key;
            z.setAttribute('value',ListaFundoInterno[key])
            document.getElementById('SlctAliasPassivo').appendChild(z) 
        }

        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true)
        z.setAttribute('selected',true)
        z.setAttribute('value','')
        document.getElementById('SlctTipo').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Aplicação';
        z.setAttribute('value','Aplicação')
        document.getElementById('SlctTipo').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Resgate Total';
        z.setAttribute('value','Resgate Total')
        document.getElementById('SlctTipo').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Resgate Parcial por Financeiro';
        z.setAttribute('value','Resgate Parcial por Financeiro')
        document.getElementById('SlctTipo').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Resgate Parcial por Quantidade de Cotas';
        z.setAttribute('value','Resgate Parcial por Quantidade de Cotas')
        document.getElementById('SlctTipo').appendChild(z) 

        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Selecione...';
        z.setAttribute('disabled',true)
        z.setAttribute('selected',true)
        z.setAttribute('value','')
        document.getElementById('filter_search').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Resgate';
        z.setAttribute('value','Resgate')
        document.getElementById('filter_search').appendChild(z) 
        var z = document.createElement('option'); // is a node
        z.innerHTML = 'Aplicação';
        z.setAttribute('value','Aplicação')
        document.getElementById('filter_search').appendChild(z) 

        var UserName = document.getElementById('hfHeaderUserName').value;
        var picturepath = document.getElementById('hfpicture').value;
        document.getElementById('imgProfile').src = picturepath;
        document.getElementById('NameUser').innerHTML = UserName + "<i class='fa fa-angle-down'></i>";

    </script>
    
<script> 

function SetaForm(valor){
if(valor == 'Resgate Parcial por Quantidade de Cotas' ){
document.getElementById('tbFinanceiro').value = '';
document.getElementById('tbQtdCotas').value = '';
document.getElementById('tbFinanceiro').disabled = true;
document.getElementById('tbQtdCotas').disabled = false;
}else if(valor == 'Resgate Parcial por Financeiro'){
document.getElementById('tbFinanceiro').value = '';
document.getElementById('tbQtdCotas').value = '';
document.getElementById('tbFinanceiro').disabled = false;
document.getElementById('tbQtdCotas').disabled = true;
}else if(valor == 'Resgate Total'){
document.getElementById('tbQtdCotas').value = '';
document.getElementById('tbFinanceiro').value = '';
document.getElementById('tbFinanceiro').disabled = true;
document.getElementById('tbQtdCotas').disabled = true;
}else if(valor == 'Aplicação'){
document.getElementById('tbQtdCotas').value = '';
document.getElementById('tbFinanceiro').value = '';
document.getElementById('tbFinanceiro').disabled = false;
document.getElementById('tbQtdCotas').disabled = true;
}else{
document.getElementById('tbQtdCotas').value = '';
document.getElementById('tbFinanceiro').value = '';
document.getElementById('tbFinanceiro').disabled = false;
document.getElementById('tbQtdCotas').disabled = false;
}
}


function LoadCodigosCotista(idfundo){
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("idFundo", idfundo);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Boletador/Passivo/LoadCodigosCotista",true);
oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){
                window.location.href = "/Login";
            }else if(trim(result['resposta']) == trim("Ok")){

                var ListaCodRefs = result['Lista']
                var DadosCodRefs = result['Dados']
                document.getElementById("hfDadosCodRefs").value = JSON.stringify(DadosCodRefs)

                var z = document.createElement('option'); // is a node
                    z.innerHTML = 'Selecione o Código...';
                    z.setAttribute('disabled',true)
                    z.setAttribute('selected',true)
                    document.getElementById('SlctCodigoCotista').appendChild(z) 
                for (var key in ListaCodRefs) {
                    var z = document.createElement('option'); // is a node
                    z.innerHTML = ListaCodRefs[key].Codigo;
                    z.setAttribute('value',ListaCodRefs[key].idCodRefCotistaFundo)
                    document.getElementById('SlctCodigoCotista').appendChild(z) 
                }

                }else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);
}


function ShowPassiveBankDetails(){
$('#ModalPassiveBankDetails').modal('show');
}


function LoadDadosCotista(idCodRefCotista){
var DadosCodRefs = JSON.parse(document.getElementById("hfDadosCodRefs").value)
var tbody = document.getElementById('tblcontas').getElementsByTagName('tbody')[0]
while (tbody.lastElementChild) {tbody.removeChild(tbody.lastElementChild);}
for (let i = 0; i < DadosCodRefs.length; i++) {
        if(DadosCodRefs[i].idCodRefCotistaFundo == idCodRefCotista){
            document.getElementById('tbAdministrador').value = DadosCodRefs[i].Administrador
            document.getElementById('tbDistribuidor').value = DadosCodRefs[i].NomeDistribuidor
            document.getElementById('tbCGCPassivo').value = DadosCodRefs[i].CGCFundo
            document.getElementById('tbCGCCotista').value = DadosCodRefs[i].CGCCotista
            document.getElementById('tbNomeCotista').value = DadosCodRefs[i].NomeCotista

            document.getElementById('account_bank').value = ''
            document.getElementById('account_agency').value = ''
            document.getElementById('account_name').value = ''

            var CGC = DadosCodRefs[i].CGCCotista;
            var Nome = DadosCodRefs[i].NomeCotista;
            var Tipo = DadosCodRefs[i].TipoCotista;
            var Banco = DadosCodRefs[i].Banco !== null ? DadosCodRefs[i].Banco : '-';
            var Agencia = DadosCodRefs[i].Agencia !== null ? DadosCodRefs[i].Agencia : '-';
            var Conta = DadosCodRefs[i].Conta !== null ? DadosCodRefs[i].Conta : '-';
            var Digito = '-';
            if (DadosCodRefs[i].Banco !== null) {var detail = "opacity: 1";} else {var detail = "opacity: 0.5";}
            var icn = document.createElement('i');
            icn.setAttribute('class','ti-check');
            icn.setAttribute('style','display: inline-block;width:10px; height:10px;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px;');
            var btn = document.createElement('a');
            btn.setAttribute('onclick','useaccount(' + i + ')');
            btn.setAttribute('style','display:block;background-color:#007bff;color:white;padding:8px 8px 8px 10px;border-radius: 40px;width:35px; height:35px;');
            btn.append(icn);
            var tr = document.createElement('tr');
            tr.setAttribute('style',detail);
            tr.setAttribute('id',detail);
            var td = document.createElement('td');td.append(Nome);tr.append(td);
            var td = document.createElement('td');td.append(CGC);tr.append(td);
            var td = document.createElement('td');td.append(Tipo);tr.append(td);
            var td = document.createElement('td');td.append(Banco);tr.append(td);
            var td = document.createElement('td');td.append(Agencia);tr.append(td);
            var td = document.createElement('td');td.append(Conta);tr.append(td);
            var td = document.createElement('td');td.append(Digito);tr.append(td);
            var td = document.createElement('td');td.append(btn);tr.append(td);

            document.getElementById('tblcontas').getElementsByTagName('tbody')[0].append(tr);
        }
}
}

function useaccount(i){
    var DadosCodRefs = JSON.parse(document.getElementById("hfDadosCodRefs").value)
    document.getElementById('account_bank').value = DadosCodRefs[i].Banco
    document.getElementById('account_agency').value = DadosCodRefs[i].Agencia
    document.getElementById('account_name').value = DadosCodRefs[i].Conta
}

function addPassiveBankDetails(){
$('#ModalPassiveBankDetails').modal('toggle');
var DadosCodRefs = JSON.parse(document.getElementById("hfDadosCodRefs").value)
for (let i = 0; i < DadosCodRefs.length; i++) {
    if(DadosCodRefs[i].idCodRefCotistaFundo == document.getElementById("SlctCodigoCotista").value){

        var fd = new FormData();
        fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
        fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value ); 
        fd.append("idCotista", DadosCodRefs[i].idCotista);
        fd.append("Banco", document.getElementById("tbbanconovo").value);
        fd.append("Agencia", document.getElementById("tbagencianova").value);
        fd.append("Conta", document.getElementById("tbcontanova").value);

        var oReq = new XMLHttpRequest();
        oReq.open('POST', "/Boletador/Passivo/AlteraContaCotista",true);
        oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){
                window.location.href = "/Login";
            }else if(trim(result['resposta']) == trim("Ok")){
                DadosCodRefs[i].Banco = document.getElementById("tbbanconovo").value
                DadosCodRefs[i].Agencia = document.getElementById("tbagencianova").value
                DadosCodRefs[i].Conta = document.getElementById("tbcontanova").value
                document.getElementById("hfDadosCodRefs").value = JSON.stringify(DadosCodRefs)
                LoadDadosCotista(DadosCodRefs[i].idCodRefCotistaFundo)
                document.getElementById("account_bank").value = document.getElementById("tbbanconovo").value
                document.getElementById("account_agency").value = document.getElementById("tbagencianova").value
                document.getElementById("account_name").value = document.getElementById("tbcontanova").value
            }else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);

}    
}
}



function Insert(){
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );

fd.append("idFundo", document.getElementById("SlctAliasPassivo").value);
fd.append("idCodRefCotistaFundo", document.getElementById("SlctCodigoCotista").value);
fd.append("Tipo", document.getElementById("SlctTipo").value);
fd.append("TipoLiquidacao", document.getElementById("SlctTipoLiquidacao").value);
fd.append("QtdCotas", document.getElementById("tbQtdCotas").value);
fd.append("Fin", document.getElementById("tbFinanceiro").value);
fd.append("DataMovimentacao", document.getElementById("tbDataBoleta").value);

var oReq = new XMLHttpRequest();
oReq.open('POST', "/Boletador/Passivo/Insert",true);
oReq.onload = function() {
            var result = JSON.parse(this.responseText);    
            if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";}
            else{
                    var dvMdl = document.getElementById("tbModalMsgBox");
                    while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                    dvMdl.innerhtml = "";
                    var span = document.createElement('span');
                    span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                    dvMdl.appendChild(span);
                    span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                    $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                    return;
                }
            }
            oReq.send(fd);
}


function CarregaBusca(){
document.getElementById("hfPage").value = 1;
var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("tbSearch").value);
fd.append("Tipo", document.getElementById("filter_search").value);
fd.append("DataIni", document.getElementById("tbDataIni").value);
fd.append("DataFim", document.getElementById("tbDataFim").value);
fd.append("Alias", '');
fd.append("Pag", 1);
fd.append("nPerPag", 10);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Boletador/Passivo/Search",true);
oReq.onload = function() {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDados");
        while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
        Tbl.innerhtml = "";
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {
            var dvMdl = document.getElementById("tbModalMsgBox");
            while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
            dvMdl.innerhtml = "";
            var span = document.createElement('span');
            span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
            dvMdl.appendChild(span);
            span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
            $(document).ready(function(){$('#ModalMsgBox').modal('show');})
            return;
        }
        else{
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                    var Header = document.createElement('tr');
                    Header.setAttribute('class',"heading-td")
                    Header.setAttribute('id',k);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["TipoCustom"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["CodRefCotistaFundo"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["DataCotizacao"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["DataLiquidacao"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["QtdCotas"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Financeiro"];Header.appendChild(HeaderCol);
                    var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                    Tbl.appendChild(Header);
                    }
        }
    }
oReq.send(fd);
}


function Delete(s){
var idLista = document.getElementById(s).id;
var fd = new FormData();
fd.append("IDPassivo", trim(Right(idLista,idLista.length-idLista.search("#")-1)));
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
var oReq = new XMLHttpRequest();
        oReq.open('POST', "/Boletador/Passivo/Delete",true);
        oReq.onload = function() {
                                        var result = JSON.parse(this.responseText); 
                                        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
                                        else{

                                                var Tbl = document.getElementById("TblDados");
                                                var vv = false;
                                                for (var i = 0, row; row = Tbl.rows[i]; i++) {
                                                    if (row.getAttribute('id') == trim(Right(idLista, idLista.length - idLista.search("#") - 1))) {
                                                        Tbl.deleteRow(i);
                                                    }
                                                }                                            

                                                var dvMdl = document.getElementById("tbModalMsgBox");
                                                while (dvMdl.lastElementChild) {dvMdl.removeChild(dvMdl.lastElementChild);}
                                                dvMdl.innerhtml = "";
                                                var span = document.createElement('span');
                                                span.setAttribute('style',"float:left;margin:15px 0px 0px 15px;");
                                                dvMdl.appendChild(span);
                                                span.innerHTML = "<p>" + trim(result['resposta']) + ".</p>";
                                                $(document).ready(function(){$('#ModalMsgBox').modal('show');})
                                                return;
                                            }
                                   }
        oReq.send(fd);
}

function Proximo(){

if(parseFloat(document.getElementById("hfnPages").value) >= parseFloat(document.getElementById("hfPage").value)+1)
{document.getElementById("hfPage").value=parseFloat(document.getElementById("hfPage").value)+1;}

var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("tbSearch").value);
fd.append("Tipo", document.getElementById("filter_search").value);
fd.append("DataIni", document.getElementById("tbDataIni").value);
fd.append("DataFim", document.getElementById("tbDataFim").value);
fd.append("Alias", '');
fd.append("Pag", document.getElementById("hfPage").value);
fd.append("nPerPag", 10);

var oReq = new XMLHttpRequest();
oReq.open('POST', "/Boletador/Passivo/Search",true);
oReq.onload = function() {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDados"); 
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {document.getElementById("LblDisplayPage").innerText='-';throw new Error(trim(result['resposta']));exit;}
        else{
            while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
            Tbl.innerhtml = "";
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                Header.setAttribute('class',"heading-td")
                Header.setAttribute('id',k);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["TipoCustom"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["CodRefCotistaFundo"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = formatDate(Dados["Lista"][k]["DataCotizacao"]);Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = formatDate(Dados["Lista"][k]["DataLiquidacao"]);Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["QtdCotas"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Financeiro"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
                }
        }
    }
oReq.send(fd);
}

function Anterior(){

if(1 <= parseFloat(document.getElementById("hfPage").value)-1)
{document.getElementById("hfPage").value=parseFloat(document.getElementById("hfPage").value)-1;}
else{throw new Error("Não tem pagina menor que 1!");}

var fd = new FormData();
fd.append("idUsuario", document.getElementById("hfUsuario_Id").value);
fd.append("UsuarioAuth", document.getElementById("hfUsuario_Auth").value );
fd.append("Search", document.getElementById("tbSearch").value);
fd.append("Tipo", document.getElementById("filter_search").value);
fd.append("DataIni", document.getElementById("tbDataIni").value);
fd.append("DataFim", document.getElementById("tbDataFim").value);
fd.append("Alias", '');
fd.append("Pag", document.getElementById("hfPage").value);
fd.append("nPerPag", 10);
var oReq = new XMLHttpRequest();
oReq.open('POST', "/Boletador/Passivo/Search",true);
oReq.onload = function() {
        var result = JSON.parse(this.responseText);  
        var Tbl = document.getElementById("TblDados"); 
        var result = JSON.parse(this.responseText);    
        if (trim(result['resposta']) == trim("Falha na Autenticação")){window.location.href = "/Login";exit;}
        if (trim(result['resposta']) != trim("Ok"))
        {document.getElementById("LblDisplayPage").innerText='-';throw new Error(trim(result['resposta']));exit;}
        else{
            while (Tbl.lastElementChild) {Tbl.removeChild(Tbl.lastElementChild);}  
            Tbl.innerhtml = "";
            var Dados=result['Dados'];
            document.getElementById("hfnPages").value = Dados["nPags"];
            document.getElementById("LblDisplayPage").innerText = Dados["Pag"]+" de "+Math.max(Dados["nPags"],1) ;
            for (k in Dados["Lista"]) {
                var Header = document.createElement('tr');
                Header.setAttribute('class',"heading-td")
                Header.setAttribute('id',k);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["TipoCustom"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Alias"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["CodRefCotistaFundo"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = formatDate(Dados["Lista"][k]["DataCotizacao"]);Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = formatDate(Dados["Lista"][k]["DataLiquidacao"]);Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["QtdCotas"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = Dados["Lista"][k]["Financeiro"];Header.appendChild(HeaderCol);
                var HeaderCol = document.createElement('td');HeaderCol.innerHTML = '<a id="DeleteObj#'+k+'" onClick="Delete(this.id)"><i class="ti-trash"></i></a>';Header.appendChild(HeaderCol);
                Tbl.appendChild(Header);
                }
        }
    }
oReq.send(fd);
}

</script>


</body>
</html>
